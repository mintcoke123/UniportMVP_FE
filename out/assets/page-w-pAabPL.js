import{u as De,f as Be,r as l,i as be,j as e,H as Fe}from"./index-DZLemZV3.js";import{g as pe,a as Q,c as _e,b as Ge,d as ze}from"./voteService-C66oeUFL.js";import{g as He,a as D,l as Oe}from"./matchingRoomService-Bm-VX4HQ.js";const Y=3,y="uniport_selected_room_id";function Ue(){const $=De(),{user:i,updateUserTeam:je}=Be(),[Z,M]=l.useState([]),[X,ee]=l.useState(""),[ye,te]=l.useState(!1),[Ne,B]=l.useState(!1),[k,P]=l.useState("chat"),[N,S]=l.useState([]),[x,R]=l.useState(null),[we,se]=l.useState([]),[ve,ke]=l.useState(!0),[V,F]=l.useState(null),[A,ae]=l.useState(null),[L,E]=l.useState(null),Se=t=>t.isJoined===!0||!!i&&t.members.some(s=>s.userId===i.id),m=we.find(t=>Se(t)&&t.memberCount<Y),[w,T]=l.useState([]),[Ie,_]=l.useState(!0),[G,I]=l.useState(null),Ce=t=>{const s=parseInt(t.replace(/^room-/,""),10);return Number.isNaN(s)||s<1?void 0:s},re=G!=null?w.find(t=>t.id===G):w.find(t=>t.status==="started")??w.find(t=>t.status==="full")??w[0],c=re?Ce(re.id):void 0;l.useEffect(()=>{if(!i||m){T([]),I(null),_(!1);return}_(!0),He().then(t=>{if(t.length>0){T(t);const s=t.find(a=>a.status==="started");if(s&&(!i?.teamId||!String(i.teamId).startsWith("team-"))){const a="team-"+s.id.replace(/^room-/,"");je(a)}I(a=>{const r=i?.teamId&&String(i.teamId).startsWith("team-")?"room-"+String(i.teamId).slice(5):null,o=r&&t.some(n=>n.id===r),d=typeof localStorage<"u"?localStorage.getItem(y):null,u=d&&t.some(n=>n.id===d),j=t.find(n=>n.status==="started")??t.find(n=>n.status==="full")??t[0],f=o?r:u?d:a&&t.some(n=>n.id===a)?a:j?.id??null;return f&&typeof localStorage<"u"&&localStorage.setItem(y,f),f});return}return D().then(s=>{const a=s.filter(r=>r.isJoined===!0||!!i&&r.members.some(o=>o.userId===i.id));T(a),I(r=>{if(a.length===0)return null;const o=i?.teamId&&String(i.teamId).startsWith("team-")?"room-"+String(i.teamId).slice(5):null,d=o&&a.some(g=>g.id===o),u=typeof localStorage<"u"?localStorage.getItem(y):null,j=u&&a.some(g=>g.id===u),f=a.find(g=>g.status==="started")??a.find(g=>g.status==="full")??a[0],n=d?o:j?u:r&&a.some(g=>g.id===r)?r:f?.id??null;return n&&typeof localStorage<"u"&&localStorage.setItem(y,n),n})})}).catch(()=>D().then(t=>{const s=t.filter(a=>a.isJoined===!0||!!i&&a.members.some(r=>r.userId===i.id));T(s),I(a=>{if(s.length===0)return null;const r=i?.teamId&&String(i.teamId).startsWith("team-")?"room-"+String(i.teamId).slice(5):null,o=r&&s.some(n=>n.id===r),d=typeof localStorage<"u"?localStorage.getItem(y):null,u=d&&s.some(n=>n.id===d),j=s.find(n=>n.status==="started")??s.find(n=>n.status==="full")??s[0],f=o?r:u?d:a&&s.some(n=>n.id===a)?a:j?.id??null;return f&&typeof localStorage<"u"&&localStorage.setItem(y,f),f})})).finally(()=>_(!1))},[i?.id,!!m]),l.useEffect(()=>{D().then(t=>{se(t),ke(!1)})},[]),l.useEffect(()=>{if(!m){if(c==null){M([]),S([]),R(null),E(null);return}E(null),pe(c).then(t=>{M(t),E(null)}).catch(t=>{M([]),E(t?.message??"이 그룹의 멤버가 아닙니다. 해당 채팅방에 참가한 멤버만 읽고 쓸 수 있습니다.")}),Q(c).then(S),be(c).then(t=>{R(t)}).catch(t=>{R(null),fetch("http://127.0.0.1:7242/ingest/a6a64c35-8528-46cf-81e3-5dc882525cc5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"chat:getGroupPortfolio:error",message:"portfolio failed",data:{groupId:c,err:String(t?.message??t)},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H1,H5"})}).catch(()=>{})})}},[m,c]);const $e=async t=>{ae(t);const s=await Oe(t);ae(null),F(null),s.success&&D().then(se).catch(()=>{})},[Me,le]=l.useState(!1),[b,ne]=l.useState(null),[Pe,z]=l.useState(null),[p,H]=l.useState(null),[ie,oe]=l.useState(0),[ce,de]=l.useState(""),[O,xe]=l.useState(!1),me=l.useRef(null),ue=i?.id!=null&&Number(i.id)||0;i?.nickname;const Re=()=>{me.current?.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{Re()},[Z]);const[W,he]=l.useState(!1),fe=async()=>{const t=X.trim();if(t===""||c==null||W)return;he(!0);const s=await Ge(c,t);he(!1),s.success?(ee(""),pe(c).then(M).catch(()=>{})):alert(s.message??"메시지 전송에 실패했습니다.")},Ve=()=>{$("/mock-investment")},J=(t,s)=>{if(c==null)return;const a=N.find(r=>r.id===t);a&&q(a)===s||ze(c,t,s).then(r=>{if(!r.success){alert(r.message??"투표 반영에 실패했습니다.");return}return Q(c).then(o=>{S(o);const d=o.find(u=>u.id===t);d?.status==="passed"&&(ne(d),le(!0),be(c).then(R).catch(()=>{}))})}).catch(()=>alert("투표 반영에 실패했습니다."))},K=(t,s)=>t.votes.filter(a=>a.vote===s).length,q=t=>t.votes.find(a=>a.userId===ue)?.vote??null,h=t=>`${t.toLocaleString("ko-KR")}원`,U=t=>`${t>=0?"+":""}${t.toFixed(2)}%`,v=(x?.profitLoss??0)>=0,Ae=(t,s)=>{const a={id:N.length+1,type:t.action,stockName:t.stockName,proposerId:0,proposerName:s||"알 수 없음",quantity:t.quantity,proposedPrice:t.pricePerShare,reason:t.reason,createdAt:new Date().toISOString().slice(0,16).replace("T"," "),expiresAt:"24시간 후 만료",votes:[],totalMembers:Y,status:"ongoing"};S([a,...N]),P("vote")};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Fe,{}),e.jsx("main",{className:"flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6",children:ve?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("span",{className:"text-gray-500",children:"불러오는 중..."})}):m?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-teal-100 flex items-center justify-center mb-6",children:e.jsx("i",{className:"ri-user-search-line text-4xl text-teal-600","aria-hidden":!0})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"팀원을 매칭중입니다..."}),e.jsxs("p",{className:"text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:m.name})," ","방에서 팀원이 모일 때까지 잠시만 기다려 주세요."]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-8",children:["현재 ",m.memberCount,"명 / ",m.capacity,"명"]}),e.jsxs("ul",{className:"flex flex-wrap justify-center gap-4 mb-8",children:[m.members.map(t=>e.jsxs("li",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"w-14 h-14 rounded-full bg-teal-500 text-white flex items-center justify-center text-lg font-semibold shrink-0 border-2 border-white shadow","aria-hidden":!0,children:t.nickname.charAt(0)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 mt-2 truncate max-w-[100px]",children:t.nickname})]},t.userId)),Array.from({length:m.capacity-m.members.length}).map((t,s)=>e.jsxs("li",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsx("i",{className:"ri-user-add-line text-2xl text-gray-400","aria-hidden":!0})}),e.jsx("span",{className:"text-sm text-gray-400 mt-2",children:"대기 중"})]},`empty-${s}`))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>$("/matching-rooms"),className:"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"매칭방 목록"}),e.jsx("button",{type:"button",onClick:()=>F(m.id),disabled:A===m.id,className:"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:A===m.id?"처리 중...":"방 나가기"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,0.9fr)_minmax(0,1.1fr)] gap-6 lg:h-[calc(100vh-6rem)] min-h-[24rem]",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden min-h-0 order-2 lg:order-1",children:[e.jsx("div",{className:"flex-shrink-0 px-4 py-3 border-b border-gray-200",children:e.jsxs("h2",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("i",{className:"ri-pie-chart-line text-teal-500"}),"팀 투자 현황"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"ri-wallet-3-line text-xl"}),e.jsx("h3",{className:"text-sm font-bold",children:"투자 요약"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"투자 원금"}),e.jsx("span",{className:"font-bold",children:h(x?.investmentAmount??0)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"현재 평가액"}),e.jsx("span",{className:"font-bold",children:h(x?.totalValue??0)})]}),e.jsxs("div",{className:"border-t border-teal-400 pt-2 flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"총 손익"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`font-bold ${v?"text-yellow-300":"text-red-200"}`,children:[v?"+":"",h(x?.profitLoss??0)]}),e.jsx("span",{className:`text-xs ml-1 ${v?"text-yellow-300":"text-red-200"}`,children:U(x?.profitLossPercentage??0)})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-3",children:"포트폴리오 구성"}),e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsxs("svg",{viewBox:"0 0 200 200",className:"w-28 h-28",children:[(x?.holdings??[]).map((t,s)=>{const a=x?.holdings??[],r=a.reduce((C,qe)=>C+qe.currentValue,0);let o=0;for(let C=0;C<s;C++)o+=a[C].currentValue/r*360;const d=t.currentValue/r*360,u=o+d,j=(o-90)*Math.PI/180,f=(u-90)*Math.PI/180,n=100+80*Math.cos(j),g=100+80*Math.sin(j),Le=100+80*Math.cos(f),Ee=100+80*Math.sin(f),Te=d>180?1:0,ge=["#14B8A6","#06B6D4","#8B5CF6","#EC4899","#F59E0B","#10B981"];return e.jsx("path",{d:`M 100 100 L ${n} ${g} A 80 80 0 ${Te} 1 ${Le} ${Ee} Z`,fill:ge[s%ge.length],opacity:"0.9"},t.id)}),e.jsx("circle",{cx:"100",cy:"100",r:"50",fill:"white"})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(x?.holdings??[]).map((t,s)=>{const a=["bg-teal-500","bg-cyan-500","bg-purple-500","bg-pink-500","bg-amber-500","bg-green-500"],r=(x?.holdings??[]).reduce((d,u)=>d+u.currentValue,0),o=r>0?(t.currentValue/r*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${a[s%a.length]}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",children:t.stockName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o,"%"]})]})]},t.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900",children:"보유 종목"}),(x?.holdings??[]).map(t=>{const s=t.currentValue-t.averagePrice*t.quantity,a=s/(t.averagePrice*t.quantity)*100,r=s>=0,o=Pe===t.id;return e.jsxs("div",{onClick:()=>z(o?null:t.id),className:`rounded-xl p-3 border transition-all cursor-pointer ${o?"border-teal-500 ring-2 ring-teal-200 bg-teal-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 truncate",children:t.stockName}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.quantity,"주 ·"," ",h(t.currentPrice)]})]}),e.jsx("p",{className:`text-xs font-semibold flex-shrink-0 ml-2 ${r?"text-green-600":"text-red-600"}`,children:U(a)})]}),o&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),H(t),oe(t.quantity),de("")},className:"w-full py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold rounded-lg hover:from-blue-600 hover:to-blue-700 cursor-pointer",children:[e.jsx("i",{className:"ri-arrow-down-line mr-1"}),"매도 투표 생성"]})]},t.id)})]})]})]}),e.jsxs("div",{className:"flex flex-col min-h-0 order-1 lg:order-2",children:[e.jsxs("header",{className:"flex-none shrink-0 px-4 py-3 flex flex-wrap items-center justify-between gap-3 bg-teal-50 border border-gray-200 border-b-0 rounded-t-2xl rounded-b-none shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 shrink-0",children:"채팅 · 투표"}),w.length>1&&e.jsx("select",{value:G??"",onChange:t=>{const s=t.target.value||null;I(s),typeof localStorage<"u"&&(s?localStorage.setItem(y,s):localStorage.removeItem(y))},className:"text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg px-3 py-1.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-teal-500 min-w-0 max-w-[12rem]","aria-label":"채팅방 선택",children:w.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.memberCount,"/",t.capacity,")"]},t.id))})]}),e.jsxs("div",{className:"flex bg-white rounded-full p-1 shadow border border-gray-300 flex-1 min-w-0 max-w-[14rem]",children:[e.jsxs("button",{type:"button",onClick:()=>P("chat"),className:`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${k==="chat"?"bg-teal-500 text-white shadow-sm":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-chat-3-line mr-1","aria-hidden":!0}),"채팅"]}),e.jsxs("button",{type:"button",onClick:()=>P("vote"),className:`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap flex items-center justify-center gap-1 ${k==="vote"?"bg-teal-500 text-white shadow-sm":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-checkbox-circle-line","aria-hidden":!0}),"투표",N.filter(t=>t.status==="ongoing").length>0&&e.jsx("span",{className:`ml-1 px-1.5 py-0.5 text-xs rounded-full ${k==="vote"?"bg-white/20 text-white":"bg-red-500 text-white"}`,children:N.filter(t=>t.status==="ongoing").length})]})]}),e.jsx("button",{type:"button",onClick:()=>B(!0),className:"text-sm text-teal-600 hover:text-teal-700 font-semibold whitespace-nowrap py-1 px-2",children:"채팅방 정보"})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-h-0 w-full overflow-hidden bg-white rounded-b-2xl rounded-t-none border border-t-0 border-gray-200 shadow-sm",children:[k==="chat"&&e.jsxs(e.Fragment,{children:[L&&e.jsx("div",{className:"flex-shrink-0 px-4 py-3 bg-amber-50 border-b border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-800",children:L})}),e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden px-4 py-3 space-y-4",children:[Z.map(t=>{const s=t.userId===ue;return e.jsxs("div",{children:[t.type==="user"&&e.jsxs("div",{className:`flex gap-3 ${s?"flex-row-reverse justify-end":""}`,children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.userNickname.charAt(0)}),e.jsxs("div",{className:`flex-1 min-w-0 ${s?"flex flex-col items-end":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.userNickname}),e.jsx("span",{className:"text-xs text-gray-400",children:t.timestamp})]}),e.jsx("div",{className:`rounded-2xl px-4 py-3 shadow-sm border w-[320px] min-w-[320px] box-border ${s?"bg-teal-500 text-white border-teal-500 rounded-tr-sm":"bg-white border-gray-100 rounded-tl-sm"}`,children:e.jsx("p",{className:`text-sm whitespace-pre-wrap ${s?"text-white":"text-gray-800"}`,children:t.message})})]})]}),t.type==="trade"&&t.tradeData&&e.jsxs("div",{className:`flex gap-3 ${s?"flex-row-reverse justify-end":""}`,children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.userNickname.charAt(0)}),e.jsxs("div",{className:`flex-1 min-w-0 ${s?"flex flex-col items-end":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.userNickname}),e.jsx("span",{className:"text-xs text-gray-400",children:t.timestamp})]}),e.jsxs("div",{onClick:()=>Ae(t.tradeData,t.userNickname||""),className:`rounded-2xl p-4 shadow-sm border w-[320px] min-w-[320px] box-border cursor-pointer hover:shadow-md transition-shadow ${s?"bg-teal-500 border-teal-500 rounded-tr-sm":"bg-gradient-to-br from-teal-50 to-teal-100 rounded-tl-sm border-teal-200"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.tradeData.action==="매수"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:[t.tradeData.action," 계획"]})}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"종목"}),e.jsx("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:t.tradeData.stockName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"수량"}),e.jsxs("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:[t.tradeData.quantity,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"희망 가격"}),e.jsx("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:h(t.tradeData.pricePerShare)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"주문 금액"}),e.jsx("span",{className:`text-sm font-bold ${s?"text-teal-100":"text-teal-600"}`,children:h(t.tradeData.totalAmount)})]})]}),e.jsx("div",{className:`border-t pt-3 mb-3 ${s?"border-teal-400":"border-teal-200"}`,children:e.jsx("p",{className:`text-sm ${s?"text-white":"text-gray-700"}`,children:t.tradeData.reason})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tradeData.tags?.map((a,r)=>e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s?"bg-white/20 text-white":"bg-white text-teal-600"}`,children:a},r))})]})]})]})]},t.id)}),e.jsx("div",{ref:me})]}),e.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 p-4",children:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Ve,className:"w-full py-2.5 mb-2 bg-gradient-to-r from-red-500 to-pink-500 text-white text-sm font-bold rounded-xl hover:from-red-600 hover:to-pink-600 cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-stock-line"}),"매수/매도 계획 공유"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:X,onChange:t=>ee(t.target.value),onKeyPress:t=>t.key==="Enter"&&fe(),placeholder:c==null?w.length===0&&!Ie?"참가 중인 채팅방이 없습니다. 매칭방에서 팀에 참가해 주세요.":"채팅방 정보를 불러오는 중...":"메시지 입력...",disabled:c==null||W||!!L,className:"flex-1 px-3 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("button",{type:"button",onClick:fe,disabled:c==null||W||!!L,className:"w-10 h-10 bg-teal-500 rounded-xl flex items-center justify-center hover:bg-teal-600 cursor-pointer transition-colors flex-shrink-0 disabled:opacity-60 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-send-plane-fill text-white text-lg"})})]})]})})]}),k==="vote"&&e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden p-4 space-y-3",children:N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-4xl text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"진행 중인 투표가 없습니다"})]}):e.jsx("div",{className:"space-y-3",children:N.map(t=>e.jsxs("div",{className:`rounded-xl p-4 border ${t.status==="passed"?"border-green-300 bg-green-50":t.status==="rejected"?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.proposerName.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-900 block truncate",children:t.proposerName}),e.jsx("span",{className:"text-xs text-gray-500",children:t.expiresAt})]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold flex-shrink-0 ${t.type==="매수"?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:t.type})]}),e.jsxs("div",{className:"bg-white/80 rounded-lg p-3 mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 truncate",children:t.stockName}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[e.jsxs("span",{children:[t.quantity,"주"]}),e.jsxs("span",{children:["제안가 ",h(t.proposedPrice)]})]}),t.executionPrice!=null&&e.jsxs("div",{className:"text-xs text-teal-600 font-semibold mt-0.5",children:["체결가 ",h(t.executionPrice)]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:t.reason})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:["찬성 ",K(t,"찬성")]}),e.jsxs("span",{className:"text-red-600 font-medium",children:["반대 ",K(t,"반대")]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:["보류 ",K(t,"보류")]}),e.jsxs("span",{className:"text-gray-400",children:[t.votes.length,"/",Y]})]}),t.status==="ongoing"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>J(t.id,"찬성"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${q(t)==="찬성"?"bg-green-500 text-white":"bg-green-100 text-green-600 hover:bg-green-200"}`,children:"찬성"}),e.jsx("button",{onClick:()=>J(t.id,"보류"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${q(t)==="보류"?"bg-gray-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"보류"}),e.jsx("button",{onClick:()=>J(t.id,"반대"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${q(t)==="반대"?"bg-red-500 text-white":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:"반대"})]}):e.jsx("div",{className:`py-2 rounded-lg text-xs font-bold text-center ${t.status==="passed"?"bg-green-500 text-white":t.status==="rejected"?"bg-red-500 text-white":"bg-gray-300 text-gray-600"}`,children:t.status==="passed"?"✓ 통과":t.status==="rejected"?"✗ 부결":"만료"})]},t.id))})})]})]})]})})}),V&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-2xl text-amber-600","aria-hidden":!0})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"방에서 나가시겠습니까?"}),e.jsx("p",{className:"text-sm text-gray-500 text-center mb-6",children:"나가시면 해당 방의 팀원 매칭에서 제외됩니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>F(null),className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",onClick:()=>$e(V),disabled:A===V,className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-amber-500 text-white hover:bg-amber-600 disabled:opacity-50 cursor-pointer",children:A===V?"처리 중...":"나가기"})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"매도 투표 생성"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종목"}),e.jsx("p",{className:"text-sm text-gray-900 font-semibold",children:p.stockName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["매도 수량 (최대 ",p.quantity,"주)"]}),e.jsx("input",{type:"number",min:1,max:p.quantity,value:ie,onChange:t=>{const s=parseInt(t.target.value,10);Number.isNaN(s)||oe(Math.min(p.quantity,Math.max(1,s)))},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"매도 이유"}),e.jsx("textarea",{value:ce,onChange:t=>de(t.target.value),placeholder:"매도 사유를 입력하세요",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 resize-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{H(null),z(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",disabled:c==null||O,onClick:async()=>{if(c==null||O)return;xe(!0);const t=ce.trim()||`${p.stockName} 매도 제안입니다.`;try{const s=await _e(c,{type:"매도",stockName:p.stockName,stockCode:p.stockCode,quantity:ie,proposedPrice:p.currentPrice,reason:t});if(!s.success){alert(s.message??"투표 생성에 실패했습니다.");return}const a=await Q(c);S(a),H(null),z(null),P("vote")}catch{alert("투표 생성에 실패했습니다.")}finally{xe(!1)}},className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-blue-500 text-white hover:bg-blue-600 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:O?"생성 중...":"투표 생성"})]})]})}),ye&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"매수/매도 계획 공유"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"모의투자 페이지에서 매수/매도 계획을 작성하고 공유할 수 있습니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>te(!1),className:"flex-1 py-3 bg-gray-200 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-300 cursor-pointer whitespace-nowrap transition-colors",children:"닫기"}),e.jsx("button",{onClick:()=>{te(!1),$("/mock-investment")},className:"flex-1 py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"모의투자로 이동"})]})]})}),Me&&b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-checkbox-circle-fill text-4xl text-green-500"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"투표 통과!"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["과반수 찬성으로"," ",e.jsx("span",{className:"font-bold",children:b.stockName})," ",b.type," 주문이 체결되었습니다."]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"종목"}),e.jsx("span",{className:"text-sm font-semibold",children:b.stockName})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"유형"}),e.jsx("span",{className:`text-sm font-semibold ${b.type==="매수"?"text-red-600":"text-blue-600"}`,children:b.type})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"수량"}),e.jsxs("span",{className:"text-sm font-semibold",children:[b.quantity,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"체결가"}),e.jsx("span",{className:"text-sm font-semibold",children:h(b.executionPrice??b.proposedPrice)})]})]}),e.jsx("button",{onClick:()=>{le(!1),ne(null)},className:"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"확인"})]})}),Ne&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"채팅방 정보"}),e.jsx("button",{onClick:()=>B(!1),className:"w-8 h-8 flex items-center justify-center cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-700"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-gray-200",children:[e.jsx("span",{className:"w-16 h-16 rounded-full bg-teal-500 text-white flex items-center justify-center text-xl font-bold shrink-0","aria-hidden":!0,children:(x?.groupName??"").charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:x?.groupName??"-"}),e.jsx("span",{className:"text-sm text-gray-500",children:"멤버 5명"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"ri-wallet-3-line text-teal-600 text-lg"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"팀 투자 현황"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"팀 투자금(실시간)"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:h(x?.investmentAmount??0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"전체 자산"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:h(x?.totalValue??0)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-teal-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"투자 손익"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`text-base font-bold ${v?"text-green-600":"text-red-600"}`,children:[v?"+":"",h(x?.profitLoss??0)]}),e.jsx("span",{className:`text-xs ml-2 ${v?"text-green-600":"text-red-600"}`,children:U(x?.profitLossPercentage??0)})]})]})]})]}),e.jsx("button",{onClick:()=>{B(!1),$("/group-portfolio")},className:"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"그룹 포트폴리오 보기"})]})]})})]})}export{Ue as default};
//# sourceMappingURL=page-w-pAabPL.js.map
