import{d as B,r as c,j as e,u as K,e as X,f as J,h as U,H as I}from"./index-dmivaNDP.js";import{s as Z,c as ee}from"./voteService-BPQRId30.js";import{g as se}from"./matchingRoomService-Dsf0VnUZ.js";async function te(l){return await B(`/api/stocks/${l}`)}const ae=({stockName:l,stockCode:i="005930"})=>{const N=`KRX:${i}`,[h,f]=c.useState("1D"),a=c.useRef(null),p=["1D","1W","3M","6M","1Y"];return c.useEffect(()=>{if(!a.current)return;const o=document.createElement("script");return o.src="https://s3.tradingview.com/tv.js",o.async=!0,o.onload=()=>{a.current&&window.TradingView&&new window.TradingView.widget({autosize:!0,symbol:N,interval:h==="1D"?"5":h==="1W"?"60":"D",timezone:"Asia/Seoul",theme:"light",style:"1",locale:"kr",toolbar_bg:"#f1f3f6",enable_publishing:!1,hide_side_toolbar:!0,allow_symbol_change:!1,container_id:"tradingview_chart",hide_top_toolbar:!1,hide_legend:!0,save_image:!1,studies:[]})},document.head.appendChild(o),()=>{document.head.contains(o)&&document.head.removeChild(o)}},[h]),e.jsxs("div",{className:"bg-white mt-2 px-5 py-5",children:[e.jsx("h3",{className:"text-base font-bold mb-4",children:"차트"}),e.jsx("div",{className:"flex gap-2 mb-4",children:p.map(o=>e.jsx("button",{onClick:()=>f(o),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${h===o?"bg-black text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:o},o))}),e.jsx("div",{ref:a,className:"w-full h-80 rounded-lg overflow-hidden border border-gray-200",children:e.jsx("div",{id:"tradingview_chart",className:"w-full h-full"})})]})},le=({holding:l})=>{const i=l.totalProfit>=0;return e.jsxs("div",{className:"bg-white mt-2 px-5 py-5",children:[e.jsx("h3",{className:"text-base font-bold mb-4",children:"내 보유내역"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"보유수량"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.quantity.toLocaleString(),"주"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"평단가"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.avgPrice.toLocaleString(),"원"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"평가금액"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.totalValue.toLocaleString(),"원"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"총수익"}),e.jsxs("p",{className:`text-base font-semibold ${i?"text-red-500":"text-blue-500"}`,children:[i?"+":"",l.totalProfit.toLocaleString(),"원",e.jsxs("span",{className:"ml-1 text-sm",children:["(",i?"+":"",l.profitRate,"%)"]})]})]})]})]})},ne=["#실적발표","#저평가","#장기투자","#급등기대"];function re(l){if(!l||!l.startsWith("team-"))return null;const i=parseInt(l.slice(5),10);return Number.isNaN(i)||i<1?null:i}function z(l){if(!l||!l.startsWith("room-"))return null;const i=parseInt(l.slice(5),10);return Number.isNaN(i)||i<1?null:i}const ie="uniport_selected_room_id",xe=()=>{const l=K(),i=X(),{user:N}=J(),[h]=U(),f=parseInt(h.get("id")||"1"),[a,p]=c.useState(null),[o,S]=c.useState(!0),k=i.state?.nameFromList,[C,_]=c.useState(null);c.useEffect(()=>{S(!0),te(f).then(p).catch(()=>p(null)).finally(()=>S(!1))},[f]);const H=a?`종목_${a.code}`:"",Q=a&&(a.name===H||a.name.startsWith("종목_")),A=a&&/^(ETF|ELW|ETN)$/i.test(String(a?.name??"").trim()),m=a&&k&&(Q||A)?k:a?.name??"",[n,y]=c.useState(null),[u,g]=c.useState(1),[b,L]=c.useState(a?.currentPrice||0),[P,T]=c.useState(""),[E,M]=c.useState([]),[O,v]=c.useState(!1),[W,F]=c.useState(!1);if(o)return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(I,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-lg text-gray-600",children:"데이터를 가져오고 있습니다"})})})]});if(!a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-600",children:"종목을 찾을 수 없습니다"}),e.jsx("button",{onClick:()=>l(-1),className:"mt-4 px-6 py-2 bg-black text-white rounded-lg",children:"돌아가기"})]})});const j=a.change>=0,w=u*b,r=a.myHolding?.quantity??0,$=t=>{y(t),L(a.currentPrice);const s=r;g(t==="sell"?s>0?Math.min(1,s):0:s>0?Math.min(1,s):1),T(""),M([])},R=()=>{y(null)},G=t=>{M(s=>s.includes(t)?s.filter(d=>d!==t):[...s,t])},V=()=>{v(!0)},Y=async()=>{_(null);let t=re(N?.teamId??null);if(t==null&&typeof localStorage<"u"){const s=localStorage.getItem(ie);s&&(t=z(s))}if(t==null){const s=await se().catch(()=>[]),d=s.find(x=>x.status==="started")??s.find(x=>x.status==="full")??s[0];t=d?z(d.id)??null:null}if(t!=null){const s=n==="buy"?"매수":"매도",d={action:s,stockName:m,quantity:u,pricePerShare:b,totalAmount:w,reason:P.trim()||`${m} ${s} 계획`,tags:E};try{await Z(t,d),await ee(t,{type:s,stockName:m,stockCode:a.code,quantity:u,proposedPrice:b,reason:d.reason})}catch(x){_(x instanceof Error?x.message:"공유에 실패했습니다.");return}}v(!1),y(null),F(!0),setTimeout(()=>l("/chat"),1e3)},D=()=>{v(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(I,{}),e.jsx("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex items-center px-4 py-4 max-w-7xl mx-auto",children:e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center gap-2 hover:bg-gray-100 rounded-lg px-1 py-2 -ml-1 transition-colors cursor-pointer",children:[e.jsx("i",{className:"ri-arrow-left-line text-xl"}),e.jsx("span",{className:"text-lg font-semibold",children:"뒤로가기"})]})})}),e.jsxs("div",{className:"bg-white px-5 py-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:a.logoColor},children:m.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:a.code})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("p",{className:"text-3xl font-bold",children:[a.currentPrice.toLocaleString(),"원"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:`text-lg font-semibold ${j?"text-red-500":"text-blue-500"}`,children:[j?"+":"",a.change.toLocaleString(),"원"]}),e.jsxs("span",{className:`text-lg font-semibold ${j?"text-red-500":"text-blue-500"}`,children:[j?"+":"",a.changeRate,"%"]})]})]})]}),e.jsx(ae,{stockName:m,stockCode:a.code}),a.myHolding&&e.jsx(le,{holding:a.myHolding}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-5 py-4 z-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>$("sell"),className:"flex-1 py-3.5 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 transition-colors cursor-pointer whitespace-nowrap",children:"매도"}),e.jsx("button",{onClick:()=>$("buy"),className:"flex-1 py-3.5 bg-red-500 text-white font-semibold rounded-xl hover:bg-red-600 transition-colors cursor-pointer whitespace-nowrap",children:"매수"})]})}),n&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:R}),e.jsxs("div",{className:"relative bg-white w-full max-w-lg rounded-t-3xl animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-bold",children:[n==="buy"?"매수":"매도"," 계획 공유"]}),e.jsx("button",{onClick:R,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded-full cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-500"})})]}),e.jsxs("div",{className:"px-5 py-5 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"종목 이름"}),e.jsx("span",{className:"font-semibold",children:m})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"거래 수량"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:n==="sell"&&r===0?0:1,max:n==="sell"||r>0?r:void 0,value:u,onChange:t=>{const s=parseInt(t.target.value,10);if(t.target.value===""){g(n==="sell"&&r===0?0:1);return}if(Number.isNaN(s))return;const d=n==="sell"&&r===0?0:1,x=n==="sell"||r>0?r:void 0,q=x!=null?Math.min(Math.max(s,d),x):Math.max(s,d);g(q)},onBlur:()=>{const t=n==="sell"&&r===0?0:1,s=n==="sell"||r>0?r:void 0;u<t?g(t):s!=null&&u>s&&g(s)},className:"w-20 py-2 px-3 text-right font-semibold border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"}),e.jsx("span",{className:"text-gray-600",children:"주"}),r>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(최대 ",r.toLocaleString(),"주)"]})]})]})]}),e.jsxs("p",{className:"text-center text-sm text-gray-500 mb-6",children:[n==="buy"?"매수":"매도"," 계획을 공유합니다"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["1주 ",n==="buy"?"매수":"매도"," 희망 가격"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:b.toLocaleString(),onChange:t=>{const s=t.target.value.replace(/,/g,"");isNaN(Number(s))||L(Number(s))},className:"w-32 text-right font-semibold bg-transparent outline-none"}),e.jsx("span",{className:"text-gray-600",children:"원"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"전체 주문 금액"}),e.jsxs("span",{className:"font-semibold",children:[w.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-600 mb-2",children:"투자 논리"}),e.jsx("textarea",{value:P,onChange:t=>T(t.target.value.slice(0,500)),placeholder:"투자를 계획하시는 이유를 작성해주세요",className:"w-full h-24 px-4 py-3 bg-gray-50 rounded-xl resize-none outline-none focus:ring-2 focus:ring-blue-500/20 text-sm",maxLength:500})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:ne.map(t=>e.jsx("button",{onClick:()=>G(t),className:`px-3 py-1.5 rounded-full text-sm cursor-pointer transition-colors whitespace-nowrap ${E.includes(t)?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t},t))}),e.jsxs("button",{onClick:V,className:`w-full py-4 rounded-xl font-semibold text-white transition-colors cursor-pointer whitespace-nowrap ${n==="buy"?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"}`,children:[n==="buy"?"매수":"매도"," 계획 공유하기"]})]})]})]}),O&&e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center px-5",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:D}),e.jsxs("div",{className:"relative bg-white w-full max-w-sm rounded-2xl overflow-hidden animate-scale-up",children:[e.jsxs("div",{className:"px-5 pt-6 pb-4 text-center",children:[e.jsxs("h4",{className:"text-lg font-bold mb-1",children:[n==="buy"?"매수":"매도"," 확인"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["아래 내용으로 ",n==="buy"?"매수":"매도"," 계획을 공유합니다"]})]}),e.jsxs("div",{className:"px-5 pb-5",children:[C&&e.jsx("p",{className:"text-sm text-red-600 mb-3",children:C}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"종목명"}),e.jsx("span",{className:"font-semibold",children:m})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"수량"}),e.jsxs("span",{className:"font-semibold",children:[u,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"1주 희망 가격"}),e.jsxs("span",{className:"font-semibold",children:[b.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"주문 금액"}),e.jsxs("span",{className:"font-semibold",children:[w.toLocaleString(),"원"]})]})]})]}),e.jsxs("div",{className:"flex border-t border-gray-100",children:[e.jsx("button",{onClick:D,className:"flex-1 py-4 text-gray-600 font-semibold hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"취소"}),e.jsx("div",{className:"w-px bg-gray-100"}),e.jsx("button",{onClick:Y,className:`flex-1 py-4 font-semibold transition-colors cursor-pointer whitespace-nowrap ${n==="buy"?"text-red-500 hover:bg-red-50":"text-blue-500 hover:bg-blue-50"}`,children:"확인"})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-[300] flex items-center justify-center px-5",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50"}),e.jsx("div",{className:"relative bg-white rounded-2xl px-8 py-6 shadow-xl animate-scale-up",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-check-line text-white text-3xl"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:"공유 완료!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"채팅방으로 이동합니다"})]})})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        @keyframes scale-up {
          from {
            transform: scale(0.9);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
        .animate-scale-up {
          animation: scale-up 0.2s ease-out;
        }
      `})]})};export{xe as default};
//# sourceMappingURL=page-PMSGSXX2.js.map
