import{u as Fe,f as _e,r as l,i as re,j as e,H as Ge}from"./index-N0Tr1OC3.js";import{g as ze,a as le,b as F,c as He,d as Je,e as Ue}from"./voteService-Mcyse8Mz.js";import{g as Ke,a as _,l as Qe}from"./matchingRoomService-IlDKq5Zu.js";const ne=3,j="uniport_selected_room_id";function et(){const E=Fe(),{user:o,updateUserTeam:Se}=_e(),[ie,N]=l.useState([]),[ce,G]=l.useState(""),[Ie,oe]=l.useState(!1),[Ce,z]=l.useState(!1),[$,T]=l.useState("chat"),[w,k]=l.useState([]),[x,S]=l.useState(null),[$e,de]=l.useState([]),[Re,Me]=l.useState(!0),[D,H]=l.useState(null),[q,xe]=l.useState(null),[R,M]=l.useState(null),[me,P]=l.useState(!1),I=l.useRef(null),Pe=t=>t.isJoined===!0||!!o&&t.members.some(s=>s.userId===o.id),m=$e.find(t=>Pe(t)&&t.memberCount<ne),[v,B]=l.useState([]),[Ve,J]=l.useState(!0),[U,V]=l.useState(null),Ae=t=>{const s=parseInt(t.replace(/^room-/,""),10);return Number.isNaN(s)||s<1?void 0:s},ue=U!=null?v.find(t=>t.id===U):v.find(t=>t.status==="started")??v.find(t=>t.status==="full")??v[0],i=ue?Ae(ue.id):void 0;l.useEffect(()=>{if(!o||m){B([]),V(null),J(!1);return}J(!0),Ke().then(t=>{if(t.length>0){B(t);const s=t.find(a=>a.status==="started");if(s&&(!o?.teamId||!String(o.teamId).startsWith("team-"))){const a="team-"+s.id.replace(/^room-/,"");Se(a)}V(a=>{const r=o?.teamId&&String(o.teamId).startsWith("team-")?"room-"+String(o.teamId).slice(5):null,c=r&&t.some(n=>n.id===r),d=typeof localStorage<"u"?localStorage.getItem(j):null,u=d&&t.some(n=>n.id===d),b=t.find(n=>n.status==="started")??t.find(n=>n.status==="full")??t[0],h=c?r:u?d:a&&t.some(n=>n.id===a)?a:b?.id??null;return h&&typeof localStorage<"u"&&localStorage.setItem(j,h),h});return}return _().then(s=>{const a=s.filter(r=>r.isJoined===!0||!!o&&r.members.some(c=>c.userId===o.id));B(a),V(r=>{if(a.length===0)return null;const c=o?.teamId&&String(o.teamId).startsWith("team-")?"room-"+String(o.teamId).slice(5):null,d=c&&a.some(f=>f.id===c),u=typeof localStorage<"u"?localStorage.getItem(j):null,b=u&&a.some(f=>f.id===u),h=a.find(f=>f.status==="started")??a.find(f=>f.status==="full")??a[0],n=d?c:b?u:r&&a.some(f=>f.id===r)?r:h?.id??null;return n&&typeof localStorage<"u"&&localStorage.setItem(j,n),n})})}).catch(()=>_().then(t=>{const s=t.filter(a=>a.isJoined===!0||!!o&&a.members.some(r=>r.userId===o.id));B(s),V(a=>{if(s.length===0)return null;const r=o?.teamId&&String(o.teamId).startsWith("team-")?"room-"+String(o.teamId).slice(5):null,c=r&&s.some(n=>n.id===r),d=typeof localStorage<"u"?localStorage.getItem(j):null,u=d&&s.some(n=>n.id===d),b=s.find(n=>n.status==="started")??s.find(n=>n.status==="full")??s[0],h=c?r:u?d:a&&s.some(n=>n.id===a)?a:b?.id??null;return h&&typeof localStorage<"u"&&localStorage.setItem(j,h),h})})).finally(()=>J(!1))},[o?.id,!!m]),l.useEffect(()=>{_().then(t=>{de(t),Me(!1)})},[]),l.useEffect(()=>{if(m)return;if(i==null||!o){N([]),k([]),S(null),M(null),P(!1);const a=I.current;a&&(a.close(),I.current=null);return}const t=ze(i);if(!t){M(null),le(i).then(a=>N(a)).catch(a=>{N([]),M(a?.message??"채팅을 불러올 수 없습니다.")}),F(i).then(k),re(i).then(S).catch(()=>S(null));return}M(null);const s=new WebSocket(t);return I.current=s,s.onopen=()=>{P(!0),le(i).then(a=>N(a)).catch(a=>{N([]),M(a?.message??"이 그룹의 멤버가 아닙니다.")}),F(i).then(k),re(i).then(S).catch(a=>{S(null),fetch("http://127.0.0.1:7242/ingest/a6a64c35-8528-46cf-81e3-5dc882525cc5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"chat:getGroupPortfolio:error",message:"portfolio failed",data:{groupId:i,err:String(a?.message??a)},timestamp:Date.now(),sessionId:"debug-session",hypothesisId:"H1,H5"})}).catch(()=>{})})},s.onmessage=a=>{try{const r=JSON.parse(a.data),c=typeof r.id=="number"?r.id:null;if(c==null)return;const d=r.type||"user",u=typeof r.userId=="number"?r.userId:0,b=typeof r.userNickname=="string"?r.userNickname:"",h=typeof r.message=="string"?r.message:void 0,n=typeof r.timestamp=="string"?r.timestamp:"",f=r.tradeData??null,W={id:c,type:d==="trade"?"trade":"user",userId:u,userNickname:b,message:h??null,timestamp:n,tradeData:f};N(A=>A.some(ae=>ae.id===W.id)?A:[...A,W])}catch{}},s.onclose=()=>{P(!1),I.current=null},s.onerror=()=>{P(!1)},()=>{s.close(),I.current=null,P(!1)}},[m,i,o?.id]);const Le=async t=>{xe(t);const s=await Qe(t);xe(null),H(null),s.success&&_().then(de).catch(()=>{})},[Ee,he]=l.useState(!1),[p,fe]=l.useState(null),[Te,K]=l.useState(null),[y,Q]=l.useState(null),[ge,be]=l.useState(0),[pe,ye]=l.useState(""),[Y,je]=l.useState(!1),Ne=l.useRef(null),Z=o?.id!=null&&Number(o.id)||0,De=o?.nickname??"나",qe=()=>{Ne.current?.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{qe()},[ie]);const[X,we]=l.useState(!1),ve=async()=>{const t=ce.trim();if(t===""||i==null||X)return;const s=I.current;if(s?.readyState===WebSocket.OPEN){s.send(JSON.stringify({userId:Z,nickname:De,message:t})),G("");return}we(!0);const a=await Je(i,t);we(!1),a.success?(G(""),le(i).then(N).catch(()=>{})):alert(a.message??"메시지 전송에 실패했습니다.")},Be=()=>{E("/mock-investment")},ee=(t,s)=>{if(i==null)return;const a=w.find(r=>r.id===t);a&&O(a)===s||Ue(i,t,s).then(r=>{if(!r.success){alert(r.message??"투표 반영에 실패했습니다.");return}return F(i).then(c=>{k(c);const d=c.find(u=>u.id===t);d?.status==="passed"&&(fe(d),he(!0),re(i).then(S).catch(()=>{}))})}).catch(()=>alert("투표 반영에 실패했습니다."))},te=(t,s)=>t.votes.filter(a=>a.vote===s).length,O=t=>t.votes.find(a=>a.userId===Z)?.vote??null,g=t=>`${t.toLocaleString("ko-KR")}원`,se=t=>`${t>=0?"+":""}${t.toFixed(2)}%`,C=(x?.profitLoss??0)>=0,Oe=(t,s)=>{const a={id:w.length+1,type:t.action,stockName:t.stockName,proposerId:0,proposerName:s||"알 수 없음",quantity:t.quantity,proposedPrice:t.pricePerShare,reason:t.reason,createdAt:new Date().toISOString().slice(0,16).replace("T"," "),expiresAt:"24시간 후 만료",votes:[],totalMembers:ne,status:"ongoing"};k([a,...w]),T("vote")};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(Ge,{}),e.jsx("main",{className:"flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6",children:Re?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("span",{className:"text-gray-500",children:"불러오는 중..."})}):m?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-teal-100 flex items-center justify-center mb-6",children:e.jsx("i",{className:"ri-user-search-line text-4xl text-teal-600","aria-hidden":!0})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"팀원을 매칭중입니다..."}),e.jsxs("p",{className:"text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:m.name})," ","방에서 팀원이 모일 때까지 잠시만 기다려 주세요."]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-8",children:["현재 ",m.memberCount,"명 / ",m.capacity,"명"]}),e.jsxs("ul",{className:"flex flex-wrap justify-center gap-4 mb-8",children:[m.members.map(t=>e.jsxs("li",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"w-14 h-14 rounded-full bg-teal-500 text-white flex items-center justify-center text-lg font-semibold shrink-0 border-2 border-white shadow","aria-hidden":!0,children:t.nickname.charAt(0)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 mt-2 truncate max-w-[100px]",children:t.nickname})]},t.userId)),Array.from({length:m.capacity-m.members.length}).map((t,s)=>e.jsxs("li",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsx("i",{className:"ri-user-add-line text-2xl text-gray-400","aria-hidden":!0})}),e.jsx("span",{className:"text-sm text-gray-400 mt-2",children:"대기 중"})]},`empty-${s}`))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>E("/matching-rooms"),className:"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"매칭방 목록"}),e.jsx("button",{type:"button",onClick:()=>H(m.id),disabled:q===m.id,className:"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:q===m.id?"처리 중...":"방 나가기"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,0.9fr)_minmax(0,1.1fr)] gap-6 lg:h-[calc(100vh-6rem)] min-h-[24rem]",children:[e.jsxs("div",{className:"flex flex-col bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden min-h-0 order-2 lg:order-1",children:[e.jsx("div",{className:"flex-shrink-0 px-4 py-3 border-b border-gray-200",children:e.jsxs("h2",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("i",{className:"ri-pie-chart-line text-teal-500"}),"팀 투자 현황"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("i",{className:"ri-wallet-3-line text-xl"}),e.jsx("h3",{className:"text-sm font-bold",children:"투자 요약"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"투자 원금"}),e.jsx("span",{className:"font-bold",children:g(x?.investmentAmount??0)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"현재 평가액"}),e.jsx("span",{className:"font-bold",children:g(x?.totalValue??0)})]}),e.jsxs("div",{className:"border-t border-teal-400 pt-2 flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-teal-100",children:"총 손익"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`font-bold ${C?"text-yellow-300":"text-red-200"}`,children:[C?"+":"",g(x?.profitLoss??0)]}),e.jsx("span",{className:`text-xs ml-1 ${C?"text-yellow-300":"text-red-200"}`,children:se(x?.profitLossPercentage??0)})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 mb-3",children:"포트폴리오 구성"}),e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsxs("svg",{viewBox:"0 0 200 200",className:"w-28 h-28",children:[(x?.holdings??[]).map((t,s)=>{const a=x?.holdings??[],r=a.reduce((L,We)=>L+We.currentValue,0);let c=0;for(let L=0;L<s;L++)c+=a[L].currentValue/r*360;const d=t.currentValue/r*360,u=c+d,b=(c-90)*Math.PI/180,h=(u-90)*Math.PI/180,n=100+80*Math.cos(b),f=100+80*Math.sin(b),W=100+80*Math.cos(h),A=100+80*Math.sin(h),ae=d>180?1:0,ke=["#14B8A6","#06B6D4","#8B5CF6","#EC4899","#F59E0B","#10B981"];return e.jsx("path",{d:`M 100 100 L ${n} ${f} A 80 80 0 ${ae} 1 ${W} ${A} Z`,fill:ke[s%ke.length],opacity:"0.9"},t.id)}),e.jsx("circle",{cx:"100",cy:"100",r:"50",fill:"white"})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(x?.holdings??[]).map((t,s)=>{const a=["bg-teal-500","bg-cyan-500","bg-purple-500","bg-pink-500","bg-amber-500","bg-green-500"],r=(x?.holdings??[]).reduce((d,u)=>d+u.currentValue,0),c=r>0?(t.currentValue/r*100).toFixed(1):"0";return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${a[s%a.length]}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",children:t.stockName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c,"%"]})]})]},t.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900",children:"보유 종목"}),(x?.holdings??[]).map(t=>{const s=t.currentValue-t.averagePrice*t.quantity,a=s/(t.averagePrice*t.quantity)*100,r=s>=0,c=Te===t.id;return e.jsxs("div",{onClick:()=>K(c?null:t.id),className:`rounded-xl p-3 border transition-all cursor-pointer ${c?"border-teal-500 ring-2 ring-teal-200 bg-teal-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 truncate",children:t.stockName}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.quantity,"주 ·"," ",g(t.currentPrice)]})]}),e.jsx("p",{className:`text-xs font-semibold flex-shrink-0 ml-2 ${r?"text-green-600":"text-red-600"}`,children:se(a)})]}),c&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),Q(t),be(t.quantity),ye("")},className:"w-full py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold rounded-lg hover:from-blue-600 hover:to-blue-700 cursor-pointer",children:[e.jsx("i",{className:"ri-arrow-down-line mr-1"}),"매도 투표 생성"]})]},t.id)})]})]})]}),e.jsxs("div",{className:"flex flex-col min-h-0 order-1 lg:order-2",children:[e.jsxs("header",{className:"flex-none shrink-0 px-4 py-3 flex flex-wrap items-center justify-between gap-3 bg-teal-50 border border-gray-200 border-b-0 rounded-t-2xl rounded-b-none shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 shrink-0",children:"채팅 · 투표"}),v.length>1&&e.jsx("select",{value:U??"",onChange:t=>{const s=t.target.value||null;V(s),typeof localStorage<"u"&&(s?localStorage.setItem(j,s):localStorage.removeItem(j))},className:"text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg px-3 py-1.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-teal-500 min-w-0 max-w-[12rem]","aria-label":"채팅방 선택",children:v.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.memberCount,"/",t.capacity,")"]},t.id))})]}),e.jsxs("div",{className:"flex bg-white rounded-full p-1 shadow border border-gray-300 flex-1 min-w-0 max-w-[14rem]",children:[e.jsxs("button",{type:"button",onClick:()=>T("chat"),className:`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${$==="chat"?"bg-teal-500 text-white shadow-sm":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-chat-3-line mr-1","aria-hidden":!0}),"채팅"]}),e.jsxs("button",{type:"button",onClick:()=>T("vote"),className:`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap flex items-center justify-center gap-1 ${$==="vote"?"bg-teal-500 text-white shadow-sm":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("i",{className:"ri-checkbox-circle-line","aria-hidden":!0}),"투표",w.filter(t=>t.status==="ongoing").length>0&&e.jsx("span",{className:`ml-1 px-1.5 py-0.5 text-xs rounded-full ${$==="vote"?"bg-white/20 text-white":"bg-red-500 text-white"}`,children:w.filter(t=>t.status==="ongoing").length})]})]}),e.jsx("button",{type:"button",onClick:()=>z(!0),className:"text-sm text-teal-600 hover:text-teal-700 font-semibold whitespace-nowrap py-1 px-2",children:"채팅방 정보"})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-h-0 w-full overflow-hidden bg-white rounded-b-2xl rounded-t-none border border-t-0 border-gray-200 shadow-sm",children:[$==="chat"&&e.jsxs(e.Fragment,{children:[R&&e.jsx("div",{className:"flex-shrink-0 px-4 py-3 bg-amber-50 border-b border-amber-200",children:e.jsx("p",{className:"text-sm text-amber-800",children:R})}),i!=null&&!R&&e.jsxs("div",{className:"flex-shrink-0 px-4 py-1.5 border-b border-gray-100 flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${me?"bg-green-500":"bg-gray-300"}`,"aria-hidden":!0}),e.jsx("span",{className:"text-xs text-gray-500",children:me?"실시간 연결됨":"연결 중… (메시지는 저장됩니다)"})]}),e.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden px-4 py-3 space-y-4",children:[ie.map(t=>{const s=t.userId===Z;return e.jsxs("div",{children:[t.type==="user"&&e.jsxs("div",{className:`flex gap-3 ${s?"flex-row-reverse justify-end":""}`,children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.userNickname.charAt(0)}),e.jsxs("div",{className:`flex-1 min-w-0 ${s?"flex flex-col items-end":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.userNickname}),e.jsx("span",{className:"text-xs text-gray-400",children:t.timestamp})]}),e.jsx("div",{className:`rounded-2xl px-4 py-3 shadow-sm border w-[320px] min-w-[320px] box-border ${s?"bg-teal-500 text-white border-teal-500 rounded-tr-sm":"bg-white border-gray-100 rounded-tl-sm"}`,children:e.jsx("p",{className:`text-sm whitespace-pre-wrap ${s?"text-white":"text-gray-800"}`,children:t.message})})]})]}),t.type==="trade"&&t.tradeData&&e.jsxs("div",{className:`flex gap-3 ${s?"flex-row-reverse justify-end":""}`,children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.userNickname.charAt(0)}),e.jsxs("div",{className:`flex-1 min-w-0 ${s?"flex flex-col items-end":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s?"flex-row-reverse":""}`,children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.userNickname}),e.jsx("span",{className:"text-xs text-gray-400",children:t.timestamp})]}),e.jsxs("div",{onClick:()=>Oe(t.tradeData,t.userNickname||""),className:`rounded-2xl p-4 shadow-sm border w-[320px] min-w-[320px] box-border cursor-pointer hover:shadow-md transition-shadow ${s?"bg-teal-500 border-teal-500 rounded-tr-sm":"bg-gradient-to-br from-teal-50 to-teal-100 rounded-tl-sm border-teal-200"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.tradeData.action==="매수"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:[t.tradeData.action," 계획"]})}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"종목"}),e.jsx("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:t.tradeData.stockName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"수량"}),e.jsxs("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:[t.tradeData.quantity,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"희망 가격"}),e.jsx("span",{className:`text-sm font-semibold ${s?"text-white":"text-gray-900"}`,children:g(t.tradeData.pricePerShare)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${s?"text-teal-100":"text-gray-600"}`,children:"주문 금액"}),e.jsx("span",{className:`text-sm font-bold ${s?"text-teal-100":"text-teal-600"}`,children:g(t.tradeData.totalAmount)})]})]}),e.jsx("div",{className:`border-t pt-3 mb-3 ${s?"border-teal-400":"border-teal-200"}`,children:e.jsx("p",{className:`text-sm ${s?"text-white":"text-gray-700"}`,children:t.tradeData.reason})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tradeData.tags?.map((a,r)=>e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s?"bg-white/20 text-white":"bg-white text-teal-600"}`,children:a},r))})]})]})]})]},t.id)}),e.jsx("div",{ref:Ne})]}),e.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 p-4",children:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Be,className:"w-full py-2.5 mb-2 bg-gradient-to-r from-red-500 to-pink-500 text-white text-sm font-bold rounded-xl hover:from-red-600 hover:to-pink-600 cursor-pointer flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-stock-line"}),"매수/매도 계획 공유"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:ce,onChange:t=>G(t.target.value),onKeyPress:t=>t.key==="Enter"&&ve(),placeholder:i==null?v.length===0&&!Ve?"참가 중인 채팅방이 없습니다. 매칭방에서 팀에 참가해 주세요.":"채팅방 정보를 불러오는 중...":"메시지 입력...",disabled:i==null||X||!!R,className:"flex-1 px-3 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("button",{type:"button",onClick:ve,disabled:i==null||X||!!R,className:"w-10 h-10 bg-teal-500 rounded-xl flex items-center justify-center hover:bg-teal-600 cursor-pointer transition-colors flex-shrink-0 disabled:opacity-60 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-send-plane-fill text-white text-lg"})})]})]})})]}),$==="vote"&&e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto overflow-x-hidden p-4 space-y-3",children:w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-4xl text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"진행 중인 투표가 없습니다"})]}):e.jsx("div",{className:"space-y-3",children:w.map(t=>e.jsxs("div",{className:`rounded-xl p-4 border ${t.status==="passed"?"border-green-300 bg-green-50":t.status==="rejected"?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:t.proposerName.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-900 block truncate",children:t.proposerName}),e.jsx("span",{className:"text-xs text-gray-500",children:t.expiresAt})]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold flex-shrink-0 ${t.type==="매수"?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:t.type})]}),e.jsxs("div",{className:"bg-white/80 rounded-lg p-3 mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 truncate",children:t.stockName}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mt-1",children:[e.jsxs("span",{children:[t.quantity,"주"]}),e.jsxs("span",{children:["제안가 ",g(t.proposedPrice)]})]}),t.executionPrice!=null&&e.jsxs("div",{className:"text-xs text-teal-600 font-semibold mt-0.5",children:["체결가 ",g(t.executionPrice)]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:t.reason})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs flex-wrap",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:["찬성 ",te(t,"찬성")]}),e.jsxs("span",{className:"text-red-600 font-medium",children:["반대 ",te(t,"반대")]}),e.jsxs("span",{className:"text-gray-500 font-medium",children:["보류 ",te(t,"보류")]}),e.jsxs("span",{className:"text-gray-400",children:[t.votes.length,"/",ne]})]}),t.status==="ongoing"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ee(t.id,"찬성"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${O(t)==="찬성"?"bg-green-500 text-white":"bg-green-100 text-green-600 hover:bg-green-200"}`,children:"찬성"}),e.jsx("button",{onClick:()=>ee(t.id,"보류"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${O(t)==="보류"?"bg-gray-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"보류"}),e.jsx("button",{onClick:()=>ee(t.id,"반대"),className:`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${O(t)==="반대"?"bg-red-500 text-white":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:"반대"})]}):e.jsx("div",{className:`py-2 rounded-lg text-xs font-bold text-center ${t.status==="passed"?"bg-green-500 text-white":t.status==="rejected"?"bg-red-500 text-white":"bg-gray-300 text-gray-600"}`,children:t.status==="passed"?"✓ 통과":t.status==="rejected"?"✗ 부결":"만료"})]},t.id))})})]})]})]})})}),D&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-2xl text-amber-600","aria-hidden":!0})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"방에서 나가시겠습니까?"}),e.jsx("p",{className:"text-sm text-gray-500 text-center mb-6",children:"나가시면 해당 방의 팀원 매칭에서 제외됩니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>H(null),className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",onClick:()=>Le(D),disabled:q===D,className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-amber-500 text-white hover:bg-amber-600 disabled:opacity-50 cursor-pointer",children:q===D?"처리 중...":"나가기"})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"매도 투표 생성"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종목"}),e.jsx("p",{className:"text-sm text-gray-900 font-semibold",children:y.stockName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["매도 수량 (최대 ",y.quantity,"주)"]}),e.jsx("input",{type:"number",min:1,max:y.quantity,value:ge,onChange:t=>{const s=parseInt(t.target.value,10);Number.isNaN(s)||be(Math.min(y.quantity,Math.max(1,s)))},className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"매도 이유"}),e.jsx("textarea",{value:pe,onChange:t=>ye(t.target.value),placeholder:"매도 사유를 입력하세요",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 resize-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{Q(null),K(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",disabled:i==null||Y,onClick:async()=>{if(i==null||Y)return;je(!0);const t=pe.trim()||`${y.stockName} 매도 제안입니다.`;try{const s=await He(i,{type:"매도",stockName:y.stockName,stockCode:y.stockCode,quantity:ge,proposedPrice:y.currentPrice,reason:t});if(!s.success){alert(s.message??"투표 생성에 실패했습니다.");return}const a=await F(i);k(a),Q(null),K(null),T("vote")}catch{alert("투표 생성에 실패했습니다.")}finally{je(!1)}},className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-blue-500 text-white hover:bg-blue-600 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:Y?"생성 중...":"투표 생성"})]})]})}),Ie&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"매수/매도 계획 공유"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"모의투자 페이지에서 매수/매도 계획을 작성하고 공유할 수 있습니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>oe(!1),className:"flex-1 py-3 bg-gray-200 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-300 cursor-pointer whitespace-nowrap transition-colors",children:"닫기"}),e.jsx("button",{onClick:()=>{oe(!1),E("/mock-investment")},className:"flex-1 py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"모의투자로 이동"})]})]})}),Ee&&p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-checkbox-circle-fill text-4xl text-green-500"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"투표 통과!"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["과반수 찬성으로"," ",e.jsx("span",{className:"font-bold",children:p.stockName})," ",p.type," 주문이 체결되었습니다."]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"종목"}),e.jsx("span",{className:"text-sm font-semibold",children:p.stockName})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"유형"}),e.jsx("span",{className:`text-sm font-semibold ${p.type==="매수"?"text-red-600":"text-blue-600"}`,children:p.type})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"수량"}),e.jsxs("span",{className:"text-sm font-semibold",children:[p.quantity,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"체결가"}),e.jsx("span",{className:"text-sm font-semibold",children:g(p.executionPrice??p.proposedPrice)})]})]}),e.jsx("button",{onClick:()=>{he(!1),fe(null)},className:"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"확인"})]})}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"채팅방 정보"}),e.jsx("button",{onClick:()=>z(!1),className:"w-8 h-8 flex items-center justify-center cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-700"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-gray-200",children:[e.jsx("span",{className:"w-16 h-16 rounded-full bg-teal-500 text-white flex items-center justify-center text-xl font-bold shrink-0","aria-hidden":!0,children:(x?.groupName??"").charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-bold text-gray-900",children:x?.groupName??"-"}),e.jsx("span",{className:"text-sm text-gray-500",children:"멤버 5명"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"ri-wallet-3-line text-teal-600 text-lg"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"팀 투자 현황"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"팀 투자금(실시간)"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:g(x?.investmentAmount??0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"전체 자산"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:g(x?.totalValue??0)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-teal-200",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"투자 손익"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`text-base font-bold ${C?"text-green-600":"text-red-600"}`,children:[C?"+":"",g(x?.profitLoss??0)]}),e.jsx("span",{className:`text-xs ml-2 ${C?"text-green-600":"text-red-600"}`,children:se(x?.profitLossPercentage??0)})]})]})]})]}),e.jsx("button",{onClick:()=>{z(!1),E("/group-portfolio")},className:"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors",children:"그룹 포트폴리오 보기"})]})]})})]})}export{et as default};
//# sourceMappingURL=page-BbLkXZ4c.js.map
