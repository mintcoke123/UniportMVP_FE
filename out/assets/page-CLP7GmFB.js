import{u as H,f as P,r as i,j as e,H as U}from"./index-BKhQJ6e7.js";import{a as h,j as W,l as Y,s as _,c as $}from"./matchingRoomService-CNIxUVau.js";const S=3;function G(){const g=H(),{updateUserTeam:I,user:o}=P(),[x,d]=i.useState([]),[j,M]=i.useState(!0),[p,c]=i.useState(null),[A,m]=i.useState(!1),[N,f]=i.useState(""),[v,w]=i.useState(!1),[u,y]=i.useState(null);i.useEffect(()=>{h().then(t=>{d(t),M(!1)})},[]);const J=async t=>{if(!o)return;if(a){alert("이미 팀에 소속되어 있어 다른 방에 참가할 수 없습니다.");return}if(r){alert("이미 참가 중인 방이 있습니다. 다른 방에 참가하려면 먼저 해당 방에서 나가세요.");return}c(t);const s=await W(t,{id:o.id,nickname:o.nickname});c(null),s.success?(s.room&&d(l=>l.map(n=>n.id===s.room.id?{...n,...s.room,isJoined:!0}:n)),h().then(d).catch(()=>{})):alert(s.message)},L=async t=>{c(t);const s=await Y(t);c(null),y(null),s.success&&h().then(d).catch(()=>{})},C=t=>y(t),F=()=>y(null),T=async t=>{c(t);const s=await _(t);if(c(null),s.success){const l=s.teamId??(s.groupId!=null?String(s.groupId):null);l&&I(l),g("/mock-investment")}},E=async()=>{if(a){alert("이미 팀에 소속되어 있어 새 방을 만들 수 없습니다.");return}if(r){alert("이미 참가 중인 방이 있습니다. 새 방을 만들려면 먼저 방을 나가세요.");return}w(!0);const t=await $(N.trim()||void 0);w(!1),t.success?(m(!1),f(""),t.room&&d(s=>[{...t.room,isJoined:!0},...s]),h().then(d).catch(()=>{})):alert(t.message)},z=t=>t.memberCount>=S,b=t=>t.isJoined===!0||!!o&&t.members.some(s=>s.userId===o.id),k=x.find(t=>b(t)&&t.memberCount<S),r=x.some(t=>b(t)),a=!!o?.teamId,R=!r&&!a;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(U,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[!j&&k&&e.jsxs("div",{className:"mb-6 p-4 bg-teal-50 border border-teal-200 rounded-2xl flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-teal-700",children:k.name}),"방에서 팀원을 기다리는 중입니다. 채팅 화면에서 대기할 수 있습니다."]}),e.jsxs("button",{type:"button",onClick:()=>g("/chat"),className:"py-2.5 px-5 rounded-xl text-sm font-semibold bg-teal-500 text-white hover:bg-teal-600 cursor-pointer transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"ri-chat-3-line text-lg","aria-hidden":!0}),"채팅에서 대기하기"]})]}),j?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("span",{className:"text-gray-500",children:"목록 불러오는 중..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"매칭방 목록"}),e.jsxs("button",{type:"button",onClick:()=>!r&&!a&&m(!0),disabled:r||a,title:a?"이미 팀에 소속되어 있어 새 방을 만들 수 없습니다.":r?"이미 참가 중인 방이 있습니다. 새 방을 만들려면 먼저 방을 나가세요.":void 0,className:"py-2.5 px-5 rounded-xl text-sm font-semibold bg-teal-500 text-white hover:bg-teal-600 cursor-pointer transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-teal-500",children:[e.jsx("i",{className:"ri-add-line text-lg","aria-hidden":!0}),"방 만들기"]})]}),x.length===0?e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-12 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"진행 중인 매칭방이 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"새 매칭방이 생성되면 여기에 표시됩니다."}),e.jsx("button",{type:"button",onClick:()=>!r&&!a&&m(!0),disabled:r||a,title:a?"이미 팀에 소속되어 있어 새 방을 만들 수 없습니다.":r?"이미 참가 중인 방이 있습니다. 새 방을 만들려면 먼저 방을 나가세요.":void 0,className:"mt-4 py-2.5 px-5 rounded-xl text-sm font-semibold bg-teal-500 text-white hover:bg-teal-600 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:"방 만들기"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(t=>{const s=z(t),l=p===t.id;return e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["멤버 ",t.memberCount,"/",t.capacity,"명",t.status==="full"&&e.jsx("span",{className:"ml-2 text-teal-600 font-medium",children:"· 모의투자 시작 가능"}),t.status==="started"&&e.jsx("span",{className:"ml-2 text-gray-500",children:"· 진행 중"})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-3",children:"멤버"}),e.jsxs("ul",{className:"space-y-3",children:[t.members.map(n=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0","aria-hidden":!0,children:n.nickname.charAt(0)}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:n.nickname})})]},n.userId)),t.members.length<t.capacity&&Array.from({length:t.capacity-t.members.length}).map((n,B)=>e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 border-2 border-dashed border-gray-200 flex-shrink-0 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-400",children:"빈 자리"})}),e.jsx("p",{className:"text-sm text-gray-400",children:"대기 중"})]},`empty-${B}`))]})]}),e.jsx("div",{className:"p-5 pt-0 flex gap-2",children:t.status==="started"?e.jsx("button",{type:"button",disabled:!0,className:"flex-1 py-2.5 rounded-xl text-sm font-medium bg-gray-100 text-gray-500 cursor-not-allowed",children:"진행 중"}):s?b(t)?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>T(t.id),disabled:l,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-500 text-white hover:bg-teal-600 disabled:opacity-50 cursor-pointer transition-colors",children:l?"처리 중...":"모의투자 시작"}),e.jsx("button",{type:"button",onClick:()=>C(t.id),disabled:l,className:"py-2.5 px-4 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"나가기"})]}):e.jsx("button",{type:"button",disabled:!0,className:"w-full py-2.5 rounded-xl text-sm font-medium bg-gray-100 text-gray-400 cursor-not-allowed",title:"방이 가득 찼습니다",children:"참가 불가 (3/3)"}):b(t)?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>g("/chat"),className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-teal-500 text-teal-600 hover:bg-teal-50 cursor-pointer transition-colors flex items-center justify-center gap-1.5",children:[e.jsx("i",{className:"ri-chat-3-line text-base","aria-hidden":!0}),"채팅에서 대기"]}),e.jsx("button",{type:"button",onClick:()=>C(t.id),disabled:l,className:"py-2.5 px-4 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"나가기"})]}):e.jsx("button",{type:"button",onClick:()=>J(t.id),disabled:l||!R,title:a?"이미 팀에 소속되어 있어 다른 방에 참가할 수 없습니다.":r?"이미 참가 중인 방이 있습니다. 나간 뒤 참가할 수 있습니다.":void 0,className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 text-white hover:bg-teal-600 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors",children:l?"처리 중...":R?"참가하기":a?"다른 팀 참가 불가":"참가 불가"})})]},t.id)})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-2xl text-amber-600","aria-hidden":!0})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"방에서 나가시겠습니까?"}),e.jsx("p",{className:"text-sm text-gray-500 text-center mb-6",children:"나가시면 해당 방의 팀원 매칭에서 제외됩니다. 다시 참가하려면 방에 새로 참가해야 합니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:F,className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",onClick:()=>L(u),disabled:p===u,className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-amber-500 text-white hover:bg-amber-600 disabled:opacity-50 cursor-pointer",children:p===u?"처리 중...":"나가기"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"모의투자방 만들기"}),e.jsx("input",{type:"text",value:N,onChange:t=>f(t.target.value),placeholder:"방 이름 (선택)",className:"w-full px-4 py-3 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 mb-4"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"비우면 자동으로 날짜 기반 이름이 붙습니다. 정원 3명이 모이면 모의투자를 시작할 수 있습니다."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),f("")},className:"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer",children:"취소"}),e.jsx("button",{type:"button",onClick:E,disabled:v,className:"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-teal-500 text-white hover:bg-teal-600 disabled:opacity-50 cursor-pointer",children:v?"만드는 중...":"만들기"})]})]})})]})]})}export{G as default};
//# sourceMappingURL=page-CLP7GmFB.js.map
