import{d as V,r as o,j as e,u as Y,e as q,f as B,h as K,H as X}from"./index-BNc7vLQK.js";import{s as J,c as U}from"./voteService-sZA6HheY.js";import{g as Z}from"./matchingRoomService-D0F4J9t1.js";async function ee(l){return await V(`/api/stocks/${l}`)}const se=({stockName:l,stockCode:i="005930"})=>{const j=`KRX:${i}`,[h,f]=o.useState("1D"),a=o.useRef(null),N=["1D","1W","3M","6M","1Y"];return o.useEffect(()=>{if(!a.current)return;const c=document.createElement("script");return c.src="https://s3.tradingview.com/tv.js",c.async=!0,c.onload=()=>{a.current&&window.TradingView&&new window.TradingView.widget({autosize:!0,symbol:j,interval:h==="1D"?"5":h==="1W"?"60":"D",timezone:"Asia/Seoul",theme:"light",style:"1",locale:"kr",toolbar_bg:"#f1f3f6",enable_publishing:!1,hide_side_toolbar:!0,allow_symbol_change:!1,container_id:"tradingview_chart",hide_top_toolbar:!1,hide_legend:!0,save_image:!1,studies:[]})},document.head.appendChild(c),()=>{document.head.contains(c)&&document.head.removeChild(c)}},[h]),e.jsxs("div",{className:"bg-white mt-2 px-5 py-5",children:[e.jsx("h3",{className:"text-base font-bold mb-4",children:"차트"}),e.jsx("div",{className:"flex gap-2 mb-4",children:N.map(c=>e.jsx("button",{onClick:()=>f(c),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap cursor-pointer ${h===c?"bg-black text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:c},c))}),e.jsx("div",{ref:a,className:"w-full h-80 rounded-lg overflow-hidden border border-gray-200",children:e.jsx("div",{id:"tradingview_chart",className:"w-full h-full"})})]})},te=({holding:l})=>{const i=l.totalProfit>=0;return e.jsxs("div",{className:"bg-white mt-2 px-5 py-5",children:[e.jsx("h3",{className:"text-base font-bold mb-4",children:"내 보유내역"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"보유수량"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.quantity.toLocaleString(),"주"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"평단가"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.avgPrice.toLocaleString(),"원"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"평가금액"}),e.jsxs("p",{className:"text-base font-semibold",children:[l.totalValue.toLocaleString(),"원"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"총수익"}),e.jsxs("p",{className:`text-base font-semibold ${i?"text-red-500":"text-blue-500"}`,children:[i?"+":"",l.totalProfit.toLocaleString(),"원",e.jsxs("span",{className:"ml-1 text-sm",children:["(",i?"+":"",l.profitRate,"%)"]})]})]})]})]})},ae=["#실적발표","#저평가","#장기투자","#급등기대"];function le(l){if(!l||!l.startsWith("team-"))return null;const i=parseInt(l.slice(5),10);return Number.isNaN(i)||i<1?null:i}function R(l){if(!l||!l.startsWith("room-"))return null;const i=parseInt(l.slice(5),10);return Number.isNaN(i)||i<1?null:i}const ne="uniport_selected_room_id",oe=()=>{const l=Y(),i=q(),{user:j}=B(),[h]=K(),f=parseInt(h.get("id")||"1"),[a,N]=o.useState(null),c=i.state?.nameFromList,[S,k]=o.useState(null);o.useEffect(()=>{ee(f).then(N)},[f]);const D=a?`종목_${a.code}`:"",I=a&&(a.name===D||a.name.startsWith("종목_")),z=a&&/^(ETF|ELW|ETN)$/i.test(String(a?.name??"").trim()),m=a&&c&&(I||z)?c:a?.name??"",[n,y]=o.useState(null),[u,g]=o.useState(1),[b,C]=o.useState(a?.currentPrice||0),[_,L]=o.useState(""),[P,T]=o.useState([]),[H,v]=o.useState(!1),[Q,A]=o.useState(!1);if(!a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-600",children:"종목을 찾을 수 없습니다"}),e.jsx("button",{onClick:()=>l(-1),className:"mt-4 px-6 py-2 bg-black text-white rounded-lg",children:"돌아가기"})]})});const p=a.change>=0,w=u*b,r=a.myHolding?.quantity??0,E=t=>{y(t),C(a.currentPrice);const s=r;g(t==="sell"?s>0?Math.min(1,s):0:s>0?Math.min(1,s):1),L(""),T([])},M=()=>{y(null)},O=t=>{T(s=>s.includes(t)?s.filter(d=>d!==t):[...s,t])},W=()=>{v(!0)},F=async()=>{k(null);let t=le(j?.teamId??null);if(t==null&&typeof localStorage<"u"){const s=localStorage.getItem(ne);s&&(t=R(s))}if(t==null){const s=await Z().catch(()=>[]),d=s.find(x=>x.status==="started")??s.find(x=>x.status==="full")??s[0];t=d?R(d.id)??null:null}if(t!=null){const s=n==="buy"?"매수":"매도",d={action:s,stockName:m,quantity:u,pricePerShare:b,totalAmount:w,reason:_.trim()||`${m} ${s} 계획`,tags:P};try{await J(t,d),await U(t,{type:s,stockName:m,stockCode:a.code,quantity:u,proposedPrice:b,reason:d.reason})}catch(x){k(x instanceof Error?x.message:"공유에 실패했습니다.");return}}v(!1),y(null),A(!0),setTimeout(()=>l("/chat"),1e3)},$=()=>{v(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(X,{}),e.jsx("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex items-center px-4 py-4 max-w-7xl mx-auto",children:e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center gap-2 hover:bg-gray-100 rounded-lg px-1 py-2 -ml-1 transition-colors cursor-pointer",children:[e.jsx("i",{className:"ri-arrow-left-line text-xl"}),e.jsx("span",{className:"text-lg font-semibold",children:"뒤로가기"})]})})}),e.jsxs("div",{className:"bg-white px-5 py-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:a.logoColor},children:m.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:m}),e.jsx("p",{className:"text-sm text-gray-500",children:a.code})]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("p",{className:"text-3xl font-bold",children:[a.currentPrice.toLocaleString(),"원"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:`text-lg font-semibold ${p?"text-red-500":"text-blue-500"}`,children:[p?"+":"",a.change.toLocaleString(),"원"]}),e.jsxs("span",{className:`text-lg font-semibold ${p?"text-red-500":"text-blue-500"}`,children:[p?"+":"",a.changeRate,"%"]})]})]})]}),e.jsx(se,{stockName:m,stockCode:a.code}),a.myHolding&&e.jsx(te,{holding:a.myHolding}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-5 py-4 z-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>E("sell"),className:"flex-1 py-3.5 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 transition-colors cursor-pointer whitespace-nowrap",children:"매도"}),e.jsx("button",{onClick:()=>E("buy"),className:"flex-1 py-3.5 bg-red-500 text-white font-semibold rounded-xl hover:bg-red-600 transition-colors cursor-pointer whitespace-nowrap",children:"매수"})]})}),n&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:M}),e.jsxs("div",{className:"relative bg-white w-full max-w-lg rounded-t-3xl animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-bold",children:[n==="buy"?"매수":"매도"," 계획 공유"]}),e.jsx("button",{onClick:M,className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded-full cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-500"})})]}),e.jsxs("div",{className:"px-5 py-5 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"종목 이름"}),e.jsx("span",{className:"font-semibold",children:m})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"거래 수량"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:n==="sell"&&r===0?0:1,max:n==="sell"||r>0?r:void 0,value:u,onChange:t=>{const s=parseInt(t.target.value,10);if(t.target.value===""){g(n==="sell"&&r===0?0:1);return}if(Number.isNaN(s))return;const d=n==="sell"&&r===0?0:1,x=n==="sell"||r>0?r:void 0,G=x!=null?Math.min(Math.max(s,d),x):Math.max(s,d);g(G)},onBlur:()=>{const t=n==="sell"&&r===0?0:1,s=n==="sell"||r>0?r:void 0;u<t?g(t):s!=null&&u>s&&g(s)},className:"w-20 py-2 px-3 text-right font-semibold border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"}),e.jsx("span",{className:"text-gray-600",children:"주"}),r>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(최대 ",r.toLocaleString(),"주)"]})]})]})]}),e.jsxs("p",{className:"text-center text-sm text-gray-500 mb-6",children:[n==="buy"?"매수":"매도"," 계획을 공유합니다"]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["1주 ",n==="buy"?"매수":"매도"," 희망 가격"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:b.toLocaleString(),onChange:t=>{const s=t.target.value.replace(/,/g,"");isNaN(Number(s))||C(Number(s))},className:"w-32 text-right font-semibold bg-transparent outline-none"}),e.jsx("span",{className:"text-gray-600",children:"원"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"전체 주문 금액"}),e.jsxs("span",{className:"font-semibold",children:[w.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-600 mb-2",children:"투자 논리"}),e.jsx("textarea",{value:_,onChange:t=>L(t.target.value.slice(0,500)),placeholder:"투자를 계획하시는 이유를 작성해주세요",className:"w-full h-24 px-4 py-3 bg-gray-50 rounded-xl resize-none outline-none focus:ring-2 focus:ring-blue-500/20 text-sm",maxLength:500})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:ae.map(t=>e.jsx("button",{onClick:()=>O(t),className:`px-3 py-1.5 rounded-full text-sm cursor-pointer transition-colors whitespace-nowrap ${P.includes(t)?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t},t))}),e.jsxs("button",{onClick:W,className:`w-full py-4 rounded-xl font-semibold text-white transition-colors cursor-pointer whitespace-nowrap ${n==="buy"?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"}`,children:[n==="buy"?"매수":"매도"," 계획 공유하기"]})]})]})]}),H&&e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center px-5",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:$}),e.jsxs("div",{className:"relative bg-white w-full max-w-sm rounded-2xl overflow-hidden animate-scale-up",children:[e.jsxs("div",{className:"px-5 pt-6 pb-4 text-center",children:[e.jsxs("h4",{className:"text-lg font-bold mb-1",children:[n==="buy"?"매수":"매도"," 확인"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["아래 내용으로 ",n==="buy"?"매수":"매도"," 계획을 공유합니다"]})]}),e.jsxs("div",{className:"px-5 pb-5",children:[S&&e.jsx("p",{className:"text-sm text-red-600 mb-3",children:S}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"종목명"}),e.jsx("span",{className:"font-semibold",children:m})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"수량"}),e.jsxs("span",{className:"font-semibold",children:[u,"주"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"1주 희망 가격"}),e.jsxs("span",{className:"font-semibold",children:[b.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"주문 금액"}),e.jsxs("span",{className:"font-semibold",children:[w.toLocaleString(),"원"]})]})]})]}),e.jsxs("div",{className:"flex border-t border-gray-100",children:[e.jsx("button",{onClick:$,className:"flex-1 py-4 text-gray-600 font-semibold hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap",children:"취소"}),e.jsx("div",{className:"w-px bg-gray-100"}),e.jsx("button",{onClick:F,className:`flex-1 py-4 font-semibold transition-colors cursor-pointer whitespace-nowrap ${n==="buy"?"text-red-500 hover:bg-red-50":"text-blue-500 hover:bg-blue-50"}`,children:"확인"})]})]})]}),Q&&e.jsxs("div",{className:"fixed inset-0 z-[300] flex items-center justify-center px-5",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50"}),e.jsx("div",{className:"relative bg-white rounded-2xl px-8 py-6 shadow-xl animate-scale-up",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-check-line text-white text-3xl"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:"공유 완료!"}),e.jsx("p",{className:"text-sm text-gray-500",children:"채팅방으로 이동합니다"})]})})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        @keyframes scale-up {
          from {
            transform: scale(0.9);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
        .animate-scale-up {
          animation: scale-up 0.2s ease-out;
        }
      `})]})};export{oe as default};
//# sourceMappingURL=page-Dbu9tr_D.js.map
