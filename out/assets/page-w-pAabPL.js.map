{"version":3,"file":"page-w-pAabPL.js","sources":["../../src/pages/chat/page.tsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport Header from \"../../components/feature/Header\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport {\n  getChatMessages,\n  sendChatMessage,\n  getVotes,\n  createVote,\n  submitVote as submitVoteApi,\n  getGroupPortfolio,\n  getMyMatchingRooms,\n  getMatchingRooms,\n  leaveMatchingRoom,\n} from \"../../services\";\nimport type {\n  ChatMessageItem,\n  VoteItem,\n  GroupPortfolioResponse,\n  GroupHoldingItem,\n  MatchingRoom,\n} from \"../../types\";\n\nconst CAPACITY = 3;\nconst STORAGE_KEY_SELECTED_ROOM = \"uniport_selected_room_id\";\n\nexport default function ChatPage() {\n  const navigate = useNavigate();\n  const { user, updateUserTeam } = useAuth();\n  const [messages, setMessages] = useState<ChatMessageItem[]>([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [showTradeModal, setShowTradeModal] = useState(false);\n  const [showGroupInfoModal, setShowGroupInfoModal] = useState(false);\n  const [rightPanelTab, setRightPanelTab] = useState<\"chat\" | \"vote\">(\"chat\");\n  const [votes, setVotes] = useState<VoteItem[]>([]);\n  const [groupPortfolioData, setGroupPortfolioData] =\n    useState<GroupPortfolioResponse | null>(null);\n\n  /** 팀원 매칭 대기: 참가한 방 중 멤버 부족한 방 → \"팀원을 매칭중입니다...\" 표시 */\n  const [matchingRooms, setMatchingRooms] = useState<MatchingRoom[]>([]);\n  const [matchingLoading, setMatchingLoading] = useState(true);\n  const [leaveConfirmRoomId, setLeaveConfirmRoomId] = useState<string | null>(\n    null,\n  );\n  const [actionRoomId, setActionRoomId] = useState<string | null>(null);\n  /** GET 채팅 목록 403 시 표시 (해당 그룹 멤버 아님) */\n  const [chatError, setChatError] = useState<string | null>(null);\n\n  const isInRoom = (room: MatchingRoom) =>\n    room.isJoined === true ||\n    (Boolean(user) && room.members.some((m) => m.userId === user!.id));\n  const myWaitingRoom = matchingRooms.find(\n    (room) => isInRoom(room) && room.memberCount < CAPACITY,\n  );\n\n  /** 내가 속한 채팅방 목록. GET /api/me/matching-rooms (채팅 진입 시 로드) */\n  const [myRooms, setMyRooms] = useState<MatchingRoom[]>([]);\n  const [myRoomsLoading, setMyRoomsLoading] = useState(true);\n  /** 선택한 방 id (예: \"room-1\"). 없으면 첫 번째 started/full 방 또는 첫 방 */\n  const [selectedRoomId, setSelectedRoomId] = useState<string | null>(null);\n\n  /** room id \"room-1\" → 채팅/그룹 API용 숫자 ID 1 */\n  const roomIdToGroupId = (roomId: string): number | undefined => {\n    const n = parseInt(roomId.replace(/^room-/, \"\"), 10);\n    return Number.isNaN(n) || n < 1 ? undefined : n;\n  };\n\n  const selectedRoom =\n    selectedRoomId != null\n      ? myRooms.find((r) => r.id === selectedRoomId)\n      : (myRooms.find((r) => r.status === \"started\") ??\n        myRooms.find((r) => r.status === \"full\") ??\n        myRooms[0]);\n  const groupId = selectedRoom ? roomIdToGroupId(selectedRoom.id) : undefined;\n\n  useEffect(() => {\n    if (!user || myWaitingRoom) {\n      setMyRooms([]);\n      setSelectedRoomId(null);\n      setMyRoomsLoading(false);\n      return;\n    }\n    setMyRoomsLoading(true);\n    getMyMatchingRooms()\n      .then((list) => {\n        if (list.length > 0) {\n          setMyRooms(list);\n          const startedRoom = list.find((r) => r.status === \"started\");\n          if (startedRoom && (!user?.teamId || !String(user.teamId).startsWith(\"team-\"))) {\n            const teamId = \"team-\" + startedRoom.id.replace(/^room-/, \"\");\n            updateUserTeam(teamId);\n          }\n          setSelectedRoomId((prev) => {\n            const teamRoomId =\n              user?.teamId && String(user.teamId).startsWith(\"team-\")\n                ? \"room-\" + String(user.teamId).slice(5)\n                : null;\n            const inListTeam =\n              teamRoomId && list.some((r) => r.id === teamRoomId);\n            const saved =\n              typeof localStorage !== \"undefined\"\n                ? localStorage.getItem(STORAGE_KEY_SELECTED_ROOM)\n                : null;\n            const inList = saved && list.some((r) => r.id === saved);\n            const first =\n              list.find((r) => r.status === \"started\") ??\n              list.find((r) => r.status === \"full\") ??\n              list[0];\n            const next = inListTeam\n              ? teamRoomId\n              : inList\n                ? saved\n                : prev && list.some((r) => r.id === prev)\n                  ? prev\n                  : (first?.id ?? null);\n            if (next && typeof localStorage !== \"undefined\")\n              localStorage.setItem(STORAGE_KEY_SELECTED_ROOM, next);\n            return next;\n          });\n          return;\n        }\n        // GET /api/me/matching-rooms 실패(500 등) 시 fallback: 전체 목록에서 내가 참가한 방만 필터\n        return getMatchingRooms().then((allRooms) => {\n          const joined = allRooms.filter(\n            (r) =>\n              r.isJoined === true ||\n              (Boolean(user) && r.members.some((m) => m.userId === user!.id)),\n          );\n          setMyRooms(joined);\n          setSelectedRoomId((prev) => {\n            if (joined.length === 0) return null;\n            const teamRoomId =\n              user?.teamId && String(user.teamId).startsWith(\"team-\")\n                ? \"room-\" + String(user.teamId).slice(5)\n                : null;\n            const inListTeam =\n              teamRoomId && joined.some((r) => r.id === teamRoomId);\n            const saved =\n              typeof localStorage !== \"undefined\"\n                ? localStorage.getItem(STORAGE_KEY_SELECTED_ROOM)\n                : null;\n            const inList = saved && joined.some((r) => r.id === saved);\n            const first =\n              joined.find((r) => r.status === \"started\") ??\n              joined.find((r) => r.status === \"full\") ??\n              joined[0];\n            const next = inListTeam\n              ? teamRoomId\n              : inList\n                ? saved\n                : prev && joined.some((r) => r.id === prev)\n                  ? prev\n                  : (first?.id ?? null);\n            if (next && typeof localStorage !== \"undefined\")\n              localStorage.setItem(STORAGE_KEY_SELECTED_ROOM, next);\n            return next;\n          });\n        });\n      })\n      .catch(() => {\n        // GET /api/me/matching-rooms 실패(500 등) 시 fallback: 전체 목록에서 내가 참가한 방만 필터\n        return getMatchingRooms().then((allRooms) => {\n          const joined = allRooms.filter(\n            (r) =>\n              r.isJoined === true ||\n              (Boolean(user) && r.members.some((m) => m.userId === user!.id)),\n          );\n          setMyRooms(joined);\n          setSelectedRoomId((prev) => {\n            if (joined.length === 0) return null;\n            const teamRoomId =\n              user?.teamId && String(user.teamId).startsWith(\"team-\")\n                ? \"room-\" + String(user.teamId).slice(5)\n                : null;\n            const inListTeam =\n              teamRoomId && joined.some((r) => r.id === teamRoomId);\n            const saved =\n              typeof localStorage !== \"undefined\"\n                ? localStorage.getItem(STORAGE_KEY_SELECTED_ROOM)\n                : null;\n            const inList = saved && joined.some((r) => r.id === saved);\n            const first =\n              joined.find((r) => r.status === \"started\") ??\n              joined.find((r) => r.status === \"full\") ??\n              joined[0];\n            const next = inListTeam\n              ? teamRoomId\n              : inList\n                ? saved\n                : prev && joined.some((r) => r.id === prev)\n                  ? prev\n                  : (first?.id ?? null);\n            if (next && typeof localStorage !== \"undefined\")\n              localStorage.setItem(STORAGE_KEY_SELECTED_ROOM, next);\n            return next;\n          });\n        });\n      })\n      .finally(() => setMyRoomsLoading(false));\n  }, [user?.id, !!myWaitingRoom]);\n\n  useEffect(() => {\n    getMatchingRooms().then((list) => {\n      setMatchingRooms(list);\n      setMatchingLoading(false);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (myWaitingRoom) return;\n    if (groupId == null) {\n      setMessages([]);\n      setVotes([]);\n      setGroupPortfolioData(null);\n      setChatError(null);\n      return;\n    }\n    setChatError(null);\n    getChatMessages(groupId)\n      .then((msgs) => {\n        setMessages(msgs);\n        setChatError(null);\n      })\n      .catch((e) => {\n        setMessages([]);\n        setChatError(\n          e?.message ??\n            \"이 그룹의 멤버가 아닙니다. 해당 채팅방에 참가한 멤버만 읽고 쓸 수 있습니다.\",\n        );\n      });\n    getVotes(groupId).then(setVotes);\n    getGroupPortfolio(groupId)\n      .then((data) => {\n        setGroupPortfolioData(data);\n      })\n      .catch((e) => {\n        setGroupPortfolioData(null);\n        // #region agent log\n        fetch(\n          \"http://127.0.0.1:7242/ingest/a6a64c35-8528-46cf-81e3-5dc882525cc5\",\n          {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              location: \"chat:getGroupPortfolio:error\",\n              message: \"portfolio failed\",\n              data: { groupId, err: String(e?.message ?? e) },\n              timestamp: Date.now(),\n              sessionId: \"debug-session\",\n              hypothesisId: \"H1,H5\",\n            }),\n          },\n        ).catch(() => {});\n        // #endregion\n      });\n  }, [myWaitingRoom, groupId]);\n\n  const handleLeaveFromChat = async (roomId: string) => {\n    setActionRoomId(roomId);\n    const result = await leaveMatchingRoom(roomId);\n    setActionRoomId(null);\n    setLeaveConfirmRoomId(null);\n    if (result.success)\n      getMatchingRooms()\n        .then(setMatchingRooms)\n        .catch(() => {});\n  };\n  const [showVoteSuccessModal, setShowVoteSuccessModal] = useState(false);\n  const [passedVote, setPassedVote] = useState<VoteItem | null>(null);\n  const [selectedStock, setSelectedStock] = useState<number | null>(null);\n  /** 매도 투표 생성 모달: 열린 보유 종목. null이면 모달 비표시 */\n  const [sellVoteModalHolding, setSellVoteModalHolding] =\n    useState<GroupHoldingItem | null>(null);\n  const [sellVoteQuantity, setSellVoteQuantity] = useState<number>(0);\n  const [sellVoteReason, setSellVoteReason] = useState<string>(\"\");\n  const [sellVoteSubmitting, setSellVoteSubmitting] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // 대회 종료 여부 (실제로는 API에서 가져와야 함)\n  const isTournamentEnded = false; // 대회 진행 중일 때 채팅 입력 UI 표시\n\n  /** 로그인 사용자 (채팅·투표 표시용) */\n  const currentUserId = user?.id != null ? Number(user.id) || 0 : 0;\n  const currentUserName = user?.nickname ?? \"나\";\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const [sending, setSending] = useState(false);\n  const handleSendMessage = async () => {\n    const text = newMessage.trim();\n    if (text === \"\" || groupId == null || sending) return;\n\n    setSending(true);\n    const result = await sendChatMessage(groupId, text);\n    setSending(false);\n    if (result.success) {\n      setNewMessage(\"\");\n      getChatMessages(groupId)\n        .then(setMessages)\n        .catch(() => {});\n    } else {\n      alert(result.message ?? \"메시지 전송에 실패했습니다.\");\n    }\n  };\n\n  const handleTradeShare = () => {\n    navigate(\"/mock-investment\");\n  };\n\n  const handleVote = (voteId: number, voteType: \"찬성\" | \"반대\" | \"보류\") => {\n    if (groupId == null) return;\n    const vote = votes.find((v) => v.id === voteId);\n    if (vote && getUserVote(vote) === voteType) return;\n    submitVoteApi(groupId, voteId, voteType)\n      .then((res) => {\n        if (!res.success) {\n          alert(res.message ?? \"투표 반영에 실패했습니다.\");\n          return;\n        }\n        return getVotes(groupId!).then((updated) => {\n          setVotes(updated);\n          const v = updated.find((x) => x.id === voteId);\n          if (v?.status === \"passed\") {\n            setPassedVote(v);\n            setShowVoteSuccessModal(true);\n            getGroupPortfolio(groupId!).then(setGroupPortfolioData).catch(() => {});\n          }\n        });\n      })\n      .catch(() => alert(\"투표 반영에 실패했습니다.\"));\n  };\n\n  const getVoteCount = (vote: VoteItem, type: \"찬성\" | \"반대\" | \"보류\") => {\n    return vote.votes.filter((v) => v.vote === type).length;\n  };\n\n  const getUserVote = (vote: VoteItem): \"찬성\" | \"반대\" | \"보류\" | null => {\n    const userVote = vote.votes.find((v) => v.userId === currentUserId);\n    return userVote?.vote ?? null;\n  };\n\n  const formatCurrency = (value: number) => {\n    return `${value.toLocaleString(\"ko-KR\")}원`;\n  };\n\n  const formatPercentage = (value: number) => {\n    const sign = value >= 0 ? \"+\" : \"\";\n    return `${sign}${value.toFixed(2)}%`;\n  };\n\n  const isProfit = (groupPortfolioData?.profitLoss ?? 0) >= 0;\n\n  const handleTradeCardClick = (\n    tradeData: {\n      action: \"매수\" | \"매도\";\n      stockName: string;\n      quantity: number;\n      pricePerShare: number;\n      reason: string;\n    },\n    userNickname: string,\n  ) => {\n    // 해당 거래 계획에 대한 투표 생성 (채팅방 정원 3명 기준)\n    const newVote: VoteItem = {\n      id: votes.length + 1,\n      type: tradeData.action,\n      stockName: tradeData.stockName,\n      proposerId: 0,\n      proposerName: userNickname || \"알 수 없음\",\n      quantity: tradeData.quantity,\n      proposedPrice: tradeData.pricePerShare,\n      reason: tradeData.reason,\n      createdAt: new Date().toISOString().slice(0, 16).replace(\"T\", \" \"),\n      expiresAt: \"24시간 후 만료\",\n      votes: [],\n      totalMembers: CAPACITY,\n      status: \"ongoing\",\n    };\n\n    setVotes([newVote, ...votes]);\n    setRightPanelTab(\"vote\");\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col\">\n      <Header />\n\n      <main className=\"flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6\">\n        {/* 팀원 매칭 대기 중: \"팀원을 매칭중입니다...\" 표시 */}\n        {matchingLoading ? (\n          <div className=\"flex justify-center py-16\">\n            <span className=\"text-gray-500\">불러오는 중...</span>\n          </div>\n        ) : myWaitingRoom ? (\n          <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\n            <div className=\"w-20 h-20 rounded-full bg-teal-100 flex items-center justify-center mb-6\">\n              <i\n                className=\"ri-user-search-line text-4xl text-teal-600\"\n                aria-hidden\n              />\n            </div>\n            <h2 className=\"text-xl font-bold text-gray-900 mb-2\">\n              팀원을 매칭중입니다...\n            </h2>\n            <p className=\"text-gray-500 mb-1\">\n              <span className=\"font-medium text-gray-700\">\n                {myWaitingRoom.name}\n              </span>{\" \"}\n              방에서 팀원이 모일 때까지 잠시만 기다려 주세요.\n            </p>\n            <p className=\"text-sm text-gray-500 mb-8\">\n              현재 {myWaitingRoom.memberCount}명 / {myWaitingRoom.capacity}명\n            </p>\n            <ul className=\"flex flex-wrap justify-center gap-4 mb-8\">\n              {myWaitingRoom.members.map((member) => (\n                <li key={member.userId} className=\"flex flex-col items-center\">\n                  <span\n                    className=\"w-14 h-14 rounded-full bg-teal-500 text-white flex items-center justify-center text-lg font-semibold shrink-0 border-2 border-white shadow\"\n                    aria-hidden\n                  >\n                    {member.nickname.charAt(0)}\n                  </span>\n                  <span className=\"text-sm font-medium text-gray-700 mt-2 truncate max-w-[100px]\">\n                    {member.nickname}\n                  </span>\n                </li>\n              ))}\n              {Array.from({\n                length: myWaitingRoom.capacity - myWaitingRoom.members.length,\n              }).map((_, i) => (\n                <li key={`empty-${i}`} className=\"flex flex-col items-center\">\n                  <div className=\"w-14 h-14 rounded-full bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center\">\n                    <i\n                      className=\"ri-user-add-line text-2xl text-gray-400\"\n                      aria-hidden\n                    />\n                  </div>\n                  <span className=\"text-sm text-gray-400 mt-2\">대기 중</span>\n                </li>\n              ))}\n            </ul>\n            <div className=\"flex gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => navigate(\"/matching-rooms\")}\n                className=\"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors\"\n              >\n                매칭방 목록\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setLeaveConfirmRoomId(myWaitingRoom.id)}\n                disabled={actionRoomId === myWaitingRoom.id}\n                className=\"py-2.5 px-6 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors\"\n              >\n                {actionRoomId === myWaitingRoom.id ? \"처리 중...\" : \"방 나가기\"}\n              </button>\n            </div>\n          </div>\n        ) : (\n          <>\n            {/* 왼쪽: 포트폴리오 | 오른쪽: 채팅/투표 토글 */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-[minmax(0,0.9fr)_minmax(0,1.1fr)] gap-6 lg:h-[calc(100vh-6rem)] min-h-[24rem]\">\n              {/* 왼쪽: 포트폴리오 */}\n              <div className=\"flex flex-col bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden min-h-0 order-2 lg:order-1\">\n                <div className=\"flex-shrink-0 px-4 py-3 border-b border-gray-200\">\n                  <h2 className=\"text-base font-bold text-gray-900 flex items-center gap-2\">\n                    <i className=\"ri-pie-chart-line text-teal-500\"></i>팀 투자\n                    현황\n                  </h2>\n                </div>\n                <div className=\"flex-1 overflow-y-auto min-h-0 p-4 space-y-4\">\n                  {/* 투자 원금 및 손익 */}\n                  <div className=\"bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <i className=\"ri-wallet-3-line text-xl\"></i>\n                      <h3 className=\"text-sm font-bold\">투자 요약</h3>\n                    </div>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex justify-between items-center text-sm\">\n                        <span className=\"text-teal-100\">투자 원금</span>\n                        <span className=\"font-bold\">\n                          {formatCurrency(\n                            groupPortfolioData?.investmentAmount ?? 0,\n                          )}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center text-sm\">\n                        <span className=\"text-teal-100\">현재 평가액</span>\n                        <span className=\"font-bold\">\n                          {formatCurrency(groupPortfolioData?.totalValue ?? 0)}\n                        </span>\n                      </div>\n                      <div className=\"border-t border-teal-400 pt-2 flex justify-between items-center text-sm\">\n                        <span className=\"text-teal-100\">총 손익</span>\n                        <div className=\"text-right\">\n                          <span\n                            className={`font-bold ${\n                              isProfit ? \"text-yellow-300\" : \"text-red-200\"\n                            }`}\n                          >\n                            {isProfit ? \"+\" : \"\"}\n                            {formatCurrency(\n                              groupPortfolioData?.profitLoss ?? 0,\n                            )}\n                          </span>\n                          <span\n                            className={`text-xs ml-1 ${\n                              isProfit ? \"text-yellow-300\" : \"text-red-200\"\n                            }`}\n                          >\n                            {formatPercentage(\n                              groupPortfolioData?.profitLossPercentage ?? 0,\n                            )}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* 파이 차트 */}\n                  <div className=\"bg-gray-50 rounded-xl p-4 border border-gray-200\">\n                    <h3 className=\"text-sm font-bold text-gray-900 mb-3\">\n                      포트폴리오 구성\n                    </h3>\n                    <div className=\"flex items-center justify-center mb-3\">\n                      <svg viewBox=\"0 0 200 200\" className=\"w-28 h-28\">\n                        {(groupPortfolioData?.holdings ?? []).map(\n                          (holding, index) => {\n                            const holdings = groupPortfolioData?.holdings ?? [];\n                            const total = holdings.reduce(\n                              (sum, h) => sum + h.currentValue,\n                              0,\n                            );\n                            let startAngle = 0;\n                            for (let i = 0; i < index; i++) {\n                              startAngle +=\n                                (holdings[i].currentValue / total) * 360;\n                            }\n                            const angle = (holding.currentValue / total) * 360;\n                            const endAngle = startAngle + angle;\n                            const startRad =\n                              ((startAngle - 90) * Math.PI) / 180;\n                            const endRad = ((endAngle - 90) * Math.PI) / 180;\n                            const x1 = 100 + 80 * Math.cos(startRad);\n                            const y1 = 100 + 80 * Math.sin(startRad);\n                            const x2 = 100 + 80 * Math.cos(endRad);\n                            const y2 = 100 + 80 * Math.sin(endRad);\n                            const largeArc = angle > 180 ? 1 : 0;\n                            const colors = [\n                              \"#14B8A6\",\n                              \"#06B6D4\",\n                              \"#8B5CF6\",\n                              \"#EC4899\",\n                              \"#F59E0B\",\n                              \"#10B981\",\n                            ];\n                            return (\n                              <path\n                                key={holding.id}\n                                d={`M 100 100 L ${x1} ${y1} A 80 80 0 ${largeArc} 1 ${x2} ${y2} Z`}\n                                fill={colors[index % colors.length]}\n                                opacity=\"0.9\"\n                              />\n                            );\n                          },\n                        )}\n                        <circle cx=\"100\" cy=\"100\" r=\"50\" fill=\"white\" />\n                      </svg>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      {(groupPortfolioData?.holdings ?? []).map(\n                        (holding, index) => {\n                          const colors = [\n                            \"bg-teal-500\",\n                            \"bg-cyan-500\",\n                            \"bg-purple-500\",\n                            \"bg-pink-500\",\n                            \"bg-amber-500\",\n                            \"bg-green-500\",\n                          ];\n                          const total = (\n                            groupPortfolioData?.holdings ?? []\n                          ).reduce((sum, h) => sum + h.currentValue, 0);\n                          const percentage =\n                            total > 0\n                              ? ((holding.currentValue / total) * 100).toFixed(\n                                  1,\n                                )\n                              : \"0\";\n                          return (\n                            <div\n                              key={holding.id}\n                              className=\"flex items-center gap-1.5\"\n                            >\n                              <div\n                                className={`w-2.5 h-2.5 rounded-full ${\n                                  colors[index % colors.length]\n                                }`}\n                              ></div>\n                              <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-xs font-medium text-gray-900 truncate\">\n                                  {holding.stockName}\n                                </p>\n                                <p className=\"text-xs text-gray-500\">\n                                  {percentage}%\n                                </p>\n                              </div>\n                            </div>\n                          );\n                        },\n                      )}\n                    </div>\n                  </div>\n\n                  {/* 보유 종목 리스트 */}\n                  <div className=\"space-y-2\">\n                    <h3 className=\"text-sm font-bold text-gray-900\">\n                      보유 종목\n                    </h3>\n                    {(groupPortfolioData?.holdings ?? []).map((holding) => {\n                      const profitLoss =\n                        holding.currentValue -\n                        holding.averagePrice * holding.quantity;\n                      const profitLossPercentage =\n                        (profitLoss /\n                          (holding.averagePrice * holding.quantity)) *\n                        100;\n                      const isProfit = profitLoss >= 0;\n                      const isSelected = selectedStock === holding.id;\n                      return (\n                        <div\n                          key={holding.id}\n                          onClick={() =>\n                            setSelectedStock(isSelected ? null : holding.id)\n                          }\n                          className={`rounded-xl p-3 border transition-all cursor-pointer ${\n                            isSelected\n                              ? \"border-teal-500 ring-2 ring-teal-200 bg-teal-50\"\n                              : \"border-gray-200 bg-white hover:border-gray-300\"\n                          }`}\n                        >\n                          <div className=\"flex items-start justify-between mb-2\">\n                            <div className=\"min-w-0\">\n                              <h4 className=\"text-sm font-bold text-gray-900 truncate\">\n                                {holding.stockName}\n                              </h4>\n                              <span className=\"text-xs text-gray-500\">\n                                {holding.quantity}주 ·{\" \"}\n                                {formatCurrency(holding.currentPrice)}\n                              </span>\n                            </div>\n                            <p\n                              className={`text-xs font-semibold flex-shrink-0 ml-2 ${\n                                isProfit ? \"text-green-600\" : \"text-red-600\"\n                              }`}\n                            >\n                              {formatPercentage(profitLossPercentage)}\n                            </p>\n                          </div>\n                          {isSelected && (\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                setSellVoteModalHolding(holding);\n                                setSellVoteQuantity(holding.quantity);\n                                setSellVoteReason(\"\");\n                              }}\n                              className=\"w-full py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold rounded-lg hover:from-blue-600 hover:to-blue-700 cursor-pointer\"\n                            >\n                              <i className=\"ri-arrow-down-line mr-1\"></i>\n                              매도 투표 생성\n                            </button>\n                          )}\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n\n              {/* 오른쪽: 채팅 위 헤더(별도 행) + 채팅 블록 카드 — 겹침 방지 */}\n              <div className=\"flex flex-col min-h-0 order-1 lg:order-2\">\n                {/* 채팅 위 헤더: 고정 높이, 본문과 겹치지 않음 */}\n                <header className=\"flex-none shrink-0 px-4 py-3 flex flex-wrap items-center justify-between gap-3 bg-teal-50 border border-gray-200 border-b-0 rounded-t-2xl rounded-b-none shadow-sm\">\n                  <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n                    <span className=\"text-sm font-bold text-gray-800 shrink-0\">\n                      채팅 · 투표\n                    </span>\n                    {myRooms.length > 1 && (\n                      <select\n                        value={selectedRoomId ?? \"\"}\n                        onChange={(e) => {\n                          const next = e.target.value || null;\n                          setSelectedRoomId(next);\n                          if (typeof localStorage !== \"undefined\") {\n                            if (next)\n                              localStorage.setItem(\n                                STORAGE_KEY_SELECTED_ROOM,\n                                next,\n                              );\n                            else\n                              localStorage.removeItem(\n                                STORAGE_KEY_SELECTED_ROOM,\n                              );\n                          }\n                        }}\n                        className=\"text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg px-3 py-1.5 cursor-pointer focus:outline-none focus:ring-2 focus:ring-teal-500 min-w-0 max-w-[12rem]\"\n                        aria-label=\"채팅방 선택\"\n                      >\n                        {myRooms.map((room) => (\n                          <option key={room.id} value={room.id}>\n                            {room.name} ({room.memberCount}/{room.capacity})\n                          </option>\n                        ))}\n                      </select>\n                    )}\n                  </div>\n                  <div className=\"flex bg-white rounded-full p-1 shadow border border-gray-300 flex-1 min-w-0 max-w-[14rem]\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setRightPanelTab(\"chat\")}\n                      className={`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${\n                        rightPanelTab === \"chat\"\n                          ? \"bg-teal-500 text-white shadow-sm\"\n                          : \"text-gray-500 hover:text-gray-700 hover:bg-gray-100\"\n                      }`}\n                    >\n                      <i className=\"ri-chat-3-line mr-1\" aria-hidden />\n                      채팅\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={() => setRightPanelTab(\"vote\")}\n                      className={`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-colors cursor-pointer whitespace-nowrap flex items-center justify-center gap-1 ${\n                        rightPanelTab === \"vote\"\n                          ? \"bg-teal-500 text-white shadow-sm\"\n                          : \"text-gray-500 hover:text-gray-700 hover:bg-gray-100\"\n                      }`}\n                    >\n                      <i className=\"ri-checkbox-circle-line\" aria-hidden />\n                      투표\n                      {votes.filter((v) => v.status === \"ongoing\").length >\n                        0 && (\n                        <span\n                          className={`ml-1 px-1.5 py-0.5 text-xs rounded-full ${\n                            rightPanelTab === \"vote\"\n                              ? \"bg-white/20 text-white\"\n                              : \"bg-red-500 text-white\"\n                          }`}\n                        >\n                          {votes.filter((v) => v.status === \"ongoing\").length}\n                        </span>\n                      )}\n                    </button>\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowGroupInfoModal(true)}\n                    className=\"text-sm text-teal-600 hover:text-teal-700 font-semibold whitespace-nowrap py-1 px-2\"\n                  >\n                    채팅방 정보\n                  </button>\n                </header>\n\n                {/* 채팅 블록 카드: 헤더 아래만 차지, 겹치지 않음 */}\n                <div className=\"flex flex-col flex-1 min-h-0 w-full overflow-hidden bg-white rounded-b-2xl rounded-t-none border border-t-0 border-gray-200 shadow-sm\">\n                  {rightPanelTab === \"chat\" && (\n                    <>\n                      {chatError && (\n                        <div className=\"flex-shrink-0 px-4 py-3 bg-amber-50 border-b border-amber-200\">\n                          <p className=\"text-sm text-amber-800\">{chatError}</p>\n                        </div>\n                      )}\n                      <div className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden px-4 py-3 space-y-4\">\n                        {messages.map((msg) => {\n                          const isMine = msg.userId === currentUserId;\n                          return (\n                          <div key={msg.id}>\n                            {msg.type === \"user\" && (\n                              <div\n                                className={`flex gap-3 ${\n                                  isMine ? \"flex-row-reverse justify-end\" : \"\"\n                                }`}\n                              >\n                                <span\n                                  className=\"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0\"\n                                  aria-hidden\n                                >\n                                  {msg.userNickname.charAt(0)}\n                                </span>\n                                <div className={`flex-1 min-w-0 ${isMine ? \"flex flex-col items-end\" : \"\"}`}>\n                                  <div className={`flex items-center gap-2 mb-1 ${isMine ? \"flex-row-reverse\" : \"\"}`}>\n                                    <span className=\"text-sm font-semibold text-gray-900\">\n                                      {msg.userNickname}\n                                    </span>\n                                    <span className=\"text-xs text-gray-400\">\n                                      {msg.timestamp}\n                                    </span>\n                                  </div>\n                                  <div\n                                    className={`rounded-2xl px-4 py-3 shadow-sm border w-[320px] min-w-[320px] box-border ${\n                                      isMine\n                                        ? \"bg-teal-500 text-white border-teal-500 rounded-tr-sm\"\n                                        : \"bg-white border-gray-100 rounded-tl-sm\"\n                                    }`}\n                                  >\n                                    <p className={`text-sm whitespace-pre-wrap ${isMine ? \"text-white\" : \"text-gray-800\"}`}>\n                                      {msg.message}\n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {msg.type === \"trade\" && msg.tradeData && (\n                              <div\n                                className={`flex gap-3 ${\n                                  isMine ? \"flex-row-reverse justify-end\" : \"\"\n                                }`}\n                              >\n                                <span\n                                  className=\"w-10 h-10 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0\"\n                                  aria-hidden\n                                >\n                                  {msg.userNickname.charAt(0)}\n                                </span>\n                                <div className={`flex-1 min-w-0 ${isMine ? \"flex flex-col items-end\" : \"\"}`}>\n                                  <div className={`flex items-center gap-2 mb-1 ${isMine ? \"flex-row-reverse\" : \"\"}`}>\n                                    <span className=\"text-sm font-semibold text-gray-900\">\n                                      {msg.userNickname}\n                                    </span>\n                                    <span className=\"text-xs text-gray-400\">\n                                      {msg.timestamp}\n                                    </span>\n                                  </div>\n                                  <div\n                                    onClick={() =>\n                                      handleTradeCardClick(\n                                        msg.tradeData,\n                                        msg.userNickname || \"\",\n                                      )\n                                    }\n                                    className={`rounded-2xl p-4 shadow-sm border w-[320px] min-w-[320px] box-border cursor-pointer hover:shadow-md transition-shadow ${\n                                      isMine\n                                        ? \"bg-teal-500 border-teal-500 rounded-tr-sm\"\n                                        : \"bg-gradient-to-br from-teal-50 to-teal-100 rounded-tl-sm border-teal-200\"\n                                    }`}\n                                  >\n                                    <div className=\"flex items-center gap-2 mb-3\">\n                                      <div\n                                        className={`px-3 py-1 rounded-full text-xs font-bold ${\n                                          msg.tradeData.action === \"매수\"\n                                            ? \"bg-red-500 text-white\"\n                                            : \"bg-blue-500 text-white\"\n                                        }`}\n                                      >\n                                        {msg.tradeData.action} 계획\n                                      </div>\n                                    </div>\n                                    <div className=\"space-y-2 mb-3\">\n                                      <div className=\"flex justify-between\">\n                                        <span className={`text-sm ${isMine ? \"text-teal-100\" : \"text-gray-600\"}`}>\n                                          종목\n                                        </span>\n                                        <span className={`text-sm font-semibold ${isMine ? \"text-white\" : \"text-gray-900\"}`}>\n                                          {msg.tradeData.stockName}\n                                        </span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className={`text-sm ${isMine ? \"text-teal-100\" : \"text-gray-600\"}`}>\n                                          수량\n                                        </span>\n                                        <span className={`text-sm font-semibold ${isMine ? \"text-white\" : \"text-gray-900\"}`}>\n                                          {msg.tradeData.quantity}주\n                                        </span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className={`text-sm ${isMine ? \"text-teal-100\" : \"text-gray-600\"}`}>\n                                          희망 가격\n                                        </span>\n                                        <span className={`text-sm font-semibold ${isMine ? \"text-white\" : \"text-gray-900\"}`}>\n                                          {formatCurrency(\n                                            msg.tradeData.pricePerShare,\n                                          )}\n                                        </span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className={`text-sm ${isMine ? \"text-teal-100\" : \"text-gray-600\"}`}>\n                                          주문 금액\n                                        </span>\n                                        <span className={`text-sm font-bold ${isMine ? \"text-teal-100\" : \"text-teal-600\"}`}>\n                                          {formatCurrency(\n                                            msg.tradeData.totalAmount,\n                                          )}\n                                        </span>\n                                      </div>\n                                    </div>\n                                    <div className={`border-t pt-3 mb-3 ${isMine ? \"border-teal-400\" : \"border-teal-200\"}`}>\n                                      <p className={`text-sm ${isMine ? \"text-white\" : \"text-gray-700\"}`}>\n                                        {msg.tradeData.reason}\n                                      </p>\n                                    </div>\n                                    <div className=\"flex flex-wrap gap-2\">\n                                      {msg.tradeData.tags?.map((tag, idx) => (\n                                        <span\n                                          key={idx}\n                                          className={`px-2 py-1 text-xs font-medium rounded-full ${isMine ? \"bg-white/20 text-white\" : \"bg-white text-teal-600\"}`}\n                                        >\n                                          {tag}\n                                        </span>\n                                      ))}\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                          );\n                        })}\n                        <div ref={messagesEndRef} />\n                      </div>\n                      {/* 채팅 입력 */}\n                      <div className=\"flex-shrink-0 border-t border-gray-200 p-4\">\n                        {isTournamentEnded ? (\n                          <button\n                            onClick={() => navigate(\"/feedback-report\")}\n                            className=\"w-full py-3 bg-gradient-to-r from-teal-500 to-teal-600 text-white text-sm font-bold rounded-xl hover:from-teal-600 hover:to-teal-700 cursor-pointer flex items-center justify-center gap-2\"\n                          >\n                            <i className=\"ri-file-chart-line\"></i>\n                            피드백 리포트 보기\n                          </button>\n                        ) : (\n                          <>\n                            <button\n                              onClick={handleTradeShare}\n                              className=\"w-full py-2.5 mb-2 bg-gradient-to-r from-red-500 to-pink-500 text-white text-sm font-bold rounded-xl hover:from-red-600 hover:to-pink-600 cursor-pointer flex items-center justify-center gap-2\"\n                            >\n                              <i className=\"ri-stock-line\"></i>\n                              매수/매도 계획 공유\n                            </button>\n                            <div className=\"flex items-center gap-2\">\n                              <input\n                                type=\"text\"\n                                value={newMessage}\n                                onChange={(e) => setNewMessage(e.target.value)}\n                                onKeyPress={(e) =>\n                                  e.key === \"Enter\" && handleSendMessage()\n                                }\n                                placeholder={\n                                  groupId == null\n                                    ? myRooms.length === 0 && !myRoomsLoading\n                                      ? \"참가 중인 채팅방이 없습니다. 매칭방에서 팀에 참가해 주세요.\"\n                                      : \"채팅방 정보를 불러오는 중...\"\n                                    : \"메시지 입력...\"\n                                }\n                                disabled={\n                                  groupId == null || sending || !!chatError\n                                }\n                                className=\"flex-1 px-3 py-2.5 bg-gray-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 disabled:opacity-60 disabled:cursor-not-allowed\"\n                              />\n                              <button\n                                type=\"button\"\n                                onClick={handleSendMessage}\n                                disabled={\n                                  groupId == null || sending || !!chatError\n                                }\n                                className=\"w-10 h-10 bg-teal-500 rounded-xl flex items-center justify-center hover:bg-teal-600 cursor-pointer transition-colors flex-shrink-0 disabled:opacity-60 disabled:cursor-not-allowed\"\n                              >\n                                <i className=\"ri-send-plane-fill text-white text-lg\"></i>\n                              </button>\n                            </div>\n                          </>\n                        )}\n                      </div>\n                    </>\n                  )}\n\n                  {rightPanelTab === \"vote\" && (\n                    <div className=\"flex-1 min-h-0 overflow-y-auto overflow-x-hidden p-4 space-y-3\">\n                      {votes.length === 0 ? (\n                        <div className=\"text-center py-12\">\n                          <i className=\"ri-checkbox-circle-line text-4xl text-gray-300 mb-2\"></i>\n                          <p className=\"text-sm text-gray-500\">\n                            진행 중인 투표가 없습니다\n                          </p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-3\">\n                          {votes.map((vote) => (\n                            <div\n                              key={vote.id}\n                              className={`rounded-xl p-4 border ${\n                                vote.status === \"passed\"\n                                  ? \"border-green-300 bg-green-50\"\n                                  : vote.status === \"rejected\"\n                                    ? \"border-red-300 bg-red-50\"\n                                    : \"border-gray-200 bg-gray-50\"\n                              }`}\n                            >\n                              <div className=\"flex items-start justify-between gap-2 mb-2\">\n                                <div className=\"flex items-center gap-2 min-w-0\">\n                                  <span\n                                    className=\"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center text-sm font-semibold shrink-0\"\n                                    aria-hidden\n                                  >\n                                    {vote.proposerName.charAt(0)}\n                                  </span>\n                                  <div className=\"min-w-0\">\n                                    <span className=\"text-xs font-semibold text-gray-900 block truncate\">\n                                      {vote.proposerName}\n                                    </span>\n                                    <span className=\"text-xs text-gray-500\">\n                                      {vote.expiresAt}\n                                    </span>\n                                  </div>\n                                </div>\n                                <span\n                                  className={`px-2 py-0.5 rounded-full text-xs font-bold flex-shrink-0 ${\n                                    vote.type === \"매수\"\n                                      ? \"bg-red-100 text-red-600\"\n                                      : \"bg-blue-100 text-blue-600\"\n                                  }`}\n                                >\n                                  {vote.type}\n                                </span>\n                              </div>\n                              <div className=\"bg-white/80 rounded-lg p-3 mb-2\">\n                                <h3 className=\"text-sm font-bold text-gray-900 truncate\">\n                                  {vote.stockName}\n                                </h3>\n                                <div className=\"flex justify-between text-xs text-gray-600 mt-1\">\n                                  <span>{vote.quantity}주</span>\n                                  <span>\n                                    제안가 {formatCurrency(vote.proposedPrice)}\n                                  </span>\n                                </div>\n                                {vote.executionPrice != null && (\n                                  <div className=\"text-xs text-teal-600 font-semibold mt-0.5\">\n                                    체결가 {formatCurrency(vote.executionPrice)}\n                                  </div>\n                                )}\n                                <p className=\"text-xs text-gray-600 mt-1 line-clamp-2\">\n                                  {vote.reason}\n                                </p>\n                              </div>\n                              <div className=\"flex items-center gap-2 mb-2 text-xs flex-wrap\">\n                                <span className=\"text-green-600 font-medium\">\n                                  찬성 {getVoteCount(vote, \"찬성\")}\n                                </span>\n                                <span className=\"text-red-600 font-medium\">\n                                  반대 {getVoteCount(vote, \"반대\")}\n                                </span>\n                                <span className=\"text-gray-500 font-medium\">\n                                  보류 {getVoteCount(vote, \"보류\")}\n                                </span>\n                                <span className=\"text-gray-400\">\n                                  {vote.votes.length}/{CAPACITY}\n                                </span>\n                              </div>\n                              {vote.status === \"ongoing\" ? (\n                                <div className=\"flex gap-2\">\n                                  <button\n                                    onClick={() => handleVote(vote.id, \"찬성\")}\n                                    className={`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${\n                                      getUserVote(vote) === \"찬성\"\n                                        ? \"bg-green-500 text-white\"\n                                        : \"bg-green-100 text-green-600 hover:bg-green-200\"\n                                    }`}\n                                  >\n                                    찬성\n                                  </button>\n                                  <button\n                                    onClick={() => handleVote(vote.id, \"보류\")}\n                                    className={`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${\n                                      getUserVote(vote) === \"보류\"\n                                        ? \"bg-gray-500 text-white\"\n                                        : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\n                                    }`}\n                                  >\n                                    보류\n                                  </button>\n                                  <button\n                                    onClick={() => handleVote(vote.id, \"반대\")}\n                                    className={`flex-1 py-2 rounded-lg text-xs font-bold cursor-pointer ${\n                                      getUserVote(vote) === \"반대\"\n                                        ? \"bg-red-500 text-white\"\n                                        : \"bg-red-100 text-red-600 hover:bg-red-200\"\n                                    }`}\n                                  >\n                                    반대\n                                  </button>\n                                </div>\n                              ) : (\n                                <div\n                                  className={`py-2 rounded-lg text-xs font-bold text-center ${\n                                    vote.status === \"passed\"\n                                      ? \"bg-green-500 text-white\"\n                                      : vote.status === \"rejected\"\n                                        ? \"bg-red-500 text-white\"\n                                        : \"bg-gray-300 text-gray-600\"\n                                  }`}\n                                >\n                                  {vote.status === \"passed\"\n                                    ? \"✓ 통과\"\n                                    : vote.status === \"rejected\"\n                                      ? \"✗ 부결\"\n                                      : \"만료\"}\n                                </div>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </>\n        )}\n      </main>\n\n      {/* 방 나가기 확인 모달 (팀원 매칭 대기 중일 때) */}\n      {leaveConfirmRoomId && myWaitingRoom && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-md p-6\">\n            <div className=\"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4\">\n              <i\n                className=\"ri-error-warning-line text-2xl text-amber-600\"\n                aria-hidden\n              />\n            </div>\n            <h3 className=\"text-lg font-bold text-gray-900 text-center mb-2\">\n              방에서 나가시겠습니까?\n            </h3>\n            <p className=\"text-sm text-gray-500 text-center mb-6\">\n              나가시면 해당 방의 팀원 매칭에서 제외됩니다.\n            </p>\n            <div className=\"flex gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => setLeaveConfirmRoomId(null)}\n                className=\"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer\"\n              >\n                취소\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => handleLeaveFromChat(leaveConfirmRoomId)}\n                disabled={actionRoomId === leaveConfirmRoomId}\n                className=\"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-amber-500 text-white hover:bg-amber-600 disabled:opacity-50 cursor-pointer\"\n              >\n                {actionRoomId === leaveConfirmRoomId ? \"처리 중...\" : \"나가기\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 매도 투표 생성 모달 */}\n      {sellVoteModalHolding && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-md p-6\">\n            <h3 className=\"text-lg font-bold text-gray-900 mb-4\">\n              매도 투표 생성\n            </h3>\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  종목\n                </label>\n                <p className=\"text-sm text-gray-900 font-semibold\">\n                  {sellVoteModalHolding.stockName}\n                </p>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  매도 수량 (최대 {sellVoteModalHolding.quantity}주)\n                </label>\n                <input\n                  type=\"number\"\n                  min={1}\n                  max={sellVoteModalHolding.quantity}\n                  value={sellVoteQuantity}\n                  onChange={(e) => {\n                    const v = parseInt(e.target.value, 10);\n                    if (!Number.isNaN(v))\n                      setSellVoteQuantity(\n                        Math.min(\n                          sellVoteModalHolding.quantity,\n                          Math.max(1, v),\n                        ),\n                      );\n                  }}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  매도 이유\n                </label>\n                <textarea\n                  value={sellVoteReason}\n                  onChange={(e) => setSellVoteReason(e.target.value)}\n                  placeholder=\"매도 사유를 입력하세요\"\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 resize-none\"\n                />\n              </div>\n            </div>\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setSellVoteModalHolding(null);\n                  setSelectedStock(null);\n                }}\n                className=\"flex-1 py-2.5 rounded-xl text-sm font-medium border border-gray-300 text-gray-700 hover:bg-gray-50 cursor-pointer\"\n              >\n                취소\n              </button>\n              <button\n                type=\"button\"\n                disabled={groupId == null || sellVoteSubmitting}\n                onClick={async () => {\n                  if (groupId == null || sellVoteSubmitting) return;\n                  setSellVoteSubmitting(true);\n                  const reason =\n                    sellVoteReason.trim() ||\n                    `${sellVoteModalHolding.stockName} 매도 제안입니다.`;\n                  try {\n                    const res = await createVote(groupId, {\n                      type: \"매도\",\n                      stockName: sellVoteModalHolding.stockName,\n                      stockCode: sellVoteModalHolding.stockCode,\n                      quantity: sellVoteQuantity,\n                      proposedPrice: sellVoteModalHolding.currentPrice,\n                      reason,\n                    });\n                    if (!res.success) {\n                      alert(res.message ?? \"투표 생성에 실패했습니다.\");\n                      return;\n                    }\n                    const updated = await getVotes(groupId);\n                    setVotes(updated);\n                    setSellVoteModalHolding(null);\n                    setSelectedStock(null);\n                    setRightPanelTab(\"vote\");\n                  } catch (e) {\n                    alert(\"투표 생성에 실패했습니다.\");\n                  } finally {\n                    setSellVoteSubmitting(false);\n                  }\n                }}\n                className=\"flex-1 py-2.5 rounded-xl text-sm font-semibold bg-blue-500 text-white hover:bg-blue-600 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {sellVoteSubmitting ? \"생성 중...\" : \"투표 생성\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 매수/매도 계획 공유 모달 */}\n      {showTradeModal && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5\">\n          <div className=\"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl\">\n            <h3 className=\"text-lg font-bold text-gray-900 mb-4\">\n              매수/매도 계획 공유\n            </h3>\n            <p className=\"text-sm text-gray-600 mb-4\">\n              모의투자 페이지에서 매수/매도 계획을 작성하고 공유할 수 있습니다.\n            </p>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => setShowTradeModal(false)}\n                className=\"flex-1 py-3 bg-gray-200 text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-300 cursor-pointer whitespace-nowrap transition-colors\"\n              >\n                닫기\n              </button>\n              <button\n                onClick={() => {\n                  setShowTradeModal(false);\n                  navigate(\"/mock-investment\");\n                }}\n                className=\"flex-1 py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors\"\n              >\n                모의투자로 이동\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* 투표 통과 모달 */}\n      {showVoteSuccessModal && passedVote && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5\">\n          <div className=\"bg-white rounded-2xl max-w-md w-full p-6 text-center\">\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <i className=\"ri-checkbox-circle-fill text-4xl text-green-500\"></i>\n            </div>\n            <h3 className=\"text-lg font-bold text-gray-900 mb-2\">투표 통과!</h3>\n            <p className=\"text-sm text-gray-600 mb-4\">\n              과반수 찬성으로{\" \"}\n              <span className=\"font-bold\">{passedVote.stockName}</span>{\" \"}\n              {passedVote.type} 주문이 체결되었습니다.\n            </p>\n            <div className=\"bg-gray-50 rounded-xl p-4 mb-4\">\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"text-sm text-gray-500\">종목</span>\n                <span className=\"text-sm font-semibold\">\n                  {passedVote.stockName}\n                </span>\n              </div>\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"text-sm text-gray-500\">유형</span>\n                <span\n                  className={`text-sm font-semibold ${\n                    passedVote.type === \"매수\"\n                      ? \"text-red-600\"\n                      : \"text-blue-600\"\n                  }`}\n                >\n                  {passedVote.type}\n                </span>\n              </div>\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"text-sm text-gray-500\">수량</span>\n                <span className=\"text-sm font-semibold\">\n                  {passedVote.quantity}주\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-sm text-gray-500\">체결가</span>\n                <span className=\"text-sm font-semibold\">\n                  {formatCurrency(\n                    passedVote.executionPrice ?? passedVote.proposedPrice,\n                  )}\n                </span>\n              </div>\n            </div>\n            <button\n              onClick={() => {\n                setShowVoteSuccessModal(false);\n                setPassedVote(null);\n              }}\n              className=\"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors\"\n            >\n              확인\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* 그룹 정보 모달 */}\n      {showGroupInfoModal && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-5\">\n          <div className=\"bg-white rounded-2xl max-w-lg w-full p-6 shadow-xl\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-lg font-bold text-gray-900\">채팅방 정보</h3>\n              <button\n                onClick={() => setShowGroupInfoModal(false)}\n                className=\"w-8 h-8 flex items-center justify-center cursor-pointer\"\n              >\n                <i className=\"ri-close-line text-xl text-gray-700\"></i>\n              </button>\n            </div>\n\n            {/* 그룹 정보 */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3 pb-4 border-b border-gray-200\">\n                <span\n                  className=\"w-16 h-16 rounded-full bg-teal-500 text-white flex items-center justify-center text-xl font-bold shrink-0\"\n                  aria-hidden\n                >\n                  {(groupPortfolioData?.groupName ?? \"\").charAt(0)}\n                </span>\n                <div>\n                  <h4 className=\"text-base font-bold text-gray-900\">\n                    {groupPortfolioData?.groupName ?? \"-\"}\n                  </h4>\n                  <span className=\"text-sm text-gray-500\">멤버 5명</span>\n                </div>\n              </div>\n\n              {/* 투자 정보 */}\n              <div className=\"bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl p-4 space-y-3\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <i className=\"ri-wallet-3-line text-teal-600 text-lg\"></i>\n                  <span className=\"text-sm font-semibold text-gray-700\">\n                    팀 투자 현황\n                  </span>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">\n                      팀 투자금(실시간)\n                    </span>\n                    <span className=\"text-base font-bold text-gray-900\">\n                      {formatCurrency(\n                        groupPortfolioData?.investmentAmount ?? 0,\n                      )}\n                    </span>\n                  </div>\n\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">전체 자산</span>\n                    <span className=\"text-base font-bold text-gray-900\">\n                      {formatCurrency(groupPortfolioData?.totalValue ?? 0)}\n                    </span>\n                  </div>\n\n                  <div className=\"flex justify-between items-center pt-2 border-t border-teal-200\">\n                    <span className=\"text-sm text-gray-600\">투자 손익</span>\n                    <div className=\"text-right\">\n                      <span\n                        className={`text-base font-bold ${\n                          isProfit ? \"text-green-600\" : \"text-red-600\"\n                        }`}\n                      >\n                        {isProfit ? \"+\" : \"\"}\n                        {formatCurrency(groupPortfolioData?.profitLoss ?? 0)}\n                      </span>\n                      <span\n                        className={`text-xs ml-2 ${\n                          isProfit ? \"text-green-600\" : \"text-red-600\"\n                        }`}\n                      >\n                        {formatPercentage(\n                          groupPortfolioData?.profitLossPercentage ?? 0,\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <button\n                onClick={() => {\n                  setShowGroupInfoModal(false);\n                  navigate(\"/group-portfolio\");\n                }}\n                className=\"w-full py-3 bg-teal-500 text-white text-sm font-bold rounded-xl hover:bg-teal-600 cursor-pointer whitespace-nowrap transition-colors\"\n              >\n                그룹 포트폴리오 보기\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["CAPACITY","STORAGE_KEY_SELECTED_ROOM","ChatPage","navigate","useNavigate","user","updateUserTeam","useAuth","messages","setMessages","useState","newMessage","setNewMessage","showTradeModal","setShowTradeModal","showGroupInfoModal","setShowGroupInfoModal","rightPanelTab","setRightPanelTab","votes","setVotes","groupPortfolioData","setGroupPortfolioData","matchingRooms","setMatchingRooms","matchingLoading","setMatchingLoading","leaveConfirmRoomId","setLeaveConfirmRoomId","actionRoomId","setActionRoomId","chatError","setChatError","isInRoom","room","m","myWaitingRoom","myRooms","setMyRooms","myRoomsLoading","setMyRoomsLoading","selectedRoomId","setSelectedRoomId","roomIdToGroupId","roomId","n","selectedRoom","r","groupId","useEffect","getMyMatchingRooms","list","startedRoom","teamId","prev","teamRoomId","inListTeam","saved","inList","first","next","getMatchingRooms","allRooms","joined","getChatMessages","msgs","e","getVotes","getGroupPortfolio","data","handleLeaveFromChat","result","leaveMatchingRoom","showVoteSuccessModal","setShowVoteSuccessModal","passedVote","setPassedVote","selectedStock","setSelectedStock","sellVoteModalHolding","setSellVoteModalHolding","sellVoteQuantity","setSellVoteQuantity","sellVoteReason","setSellVoteReason","sellVoteSubmitting","setSellVoteSubmitting","messagesEndRef","useRef","currentUserId","scrollToBottom","sending","setSending","handleSendMessage","text","sendChatMessage","handleTradeShare","handleVote","voteId","voteType","vote","v","getUserVote","submitVoteApi","res","updated","x","getVoteCount","type","formatCurrency","value","formatPercentage","isProfit","handleTradeCardClick","tradeData","userNickname","newVote","jsxs","jsx","Header","member","_","i","Fragment","holding","index","holdings","total","sum","h","startAngle","angle","endAngle","startRad","endRad","x1","y1","x2","y2","largeArc","colors","percentage","profitLoss","profitLossPercentage","isSelected","msg","isMine","tag","idx","reason","createVote"],"mappings":"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"}