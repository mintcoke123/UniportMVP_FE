import{d as g,l as S,m as xe,k as ue,u as pe,f as he,r as a,j as e}from"./index-DZLemZV3.js";async function _(){return await g("/api/admin/competitions")}async function ge(n){const l=new Date(n.startDate);return new Date(n.endDate).getTime()<=l.getTime()?{success:!1,message:"종료일은 시작일보다 이후여야 합니다."}:await ue("/api/admin/competitions",n)}async function ye(n,l){return await xe(`/api/admin/competitions/${n}`,l)}async function be(n){return await g(`/api/admin/competitions/${n}/teams`)}async function q(){return await g("/api/admin/matching-rooms")}async function fe(n){return await S(`/api/admin/matching-rooms/${encodeURIComponent(n)}`)}async function je(n,l){return await S(`/api/admin/matching-rooms/${encodeURIComponent(n)}/members/${encodeURIComponent(l)}`)}async function H(){return await g("/api/admin/users")}async function Ne(n){return await S(`/api/admin/users/${encodeURIComponent(n)}`)}const J={upcoming:"예정",ongoing:"진행 중",ended:"종료"};function Q(n){if(!n||!n.trim())return"-";const l=n.trim(),c=(l.includes("T"),l.slice(0,10));try{return new Date(c+"T12:00:00").toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return c}}function Ce(){const n=pe(),{user:l,logout:c}=he(),[u,W]=a.useState("competition"),[D,k]=a.useState([]),[X,Y]=a.useState([]),[Z,A]=a.useState([]),[ee,$]=a.useState([]),[te,R]=a.useState(!0),[m,E]=a.useState(null),[se,y]=a.useState(!1),[p,b]=a.useState(null),[h,f]=a.useState(""),[j,N]=a.useState(""),[v,w]=a.useState(""),[I,o]=a.useState(""),[U,M]=a.useState(!1),[L,T]=a.useState(null),[P,F]=a.useState(null),[K,i]=a.useState(null),[O,z]=a.useState(null),[B,x]=a.useState(null),G=()=>{_().then(k)},V=()=>{q().then(A)},ae=async t=>{if(window.confirm("이 매칭방을 삭제하면 모든 멤버가 제거됩니다. 계속할까요?")){i(null),T(t);try{const s=await fe(t);s.success?(i(null),V()):i(s.message)}catch(s){i(s?.message??"삭제에 실패했습니다.")}finally{T(null)}}},ne=async(t,s)=>{if(!window.confirm("이 멤버를 팀에서 강제 제거합니다. 계속할까요?"))return;i(null);const r=`${t}-${s}`;F(r);try{const d=await je(t,s);d.success?(i(null),V()):i(d.message)}catch(d){i(d?.message??"멤버 제거에 실패했습니다.")}finally{F(null)}},le=()=>{H().then($)},re=async t=>{if(t.role==="admin"){x("관리자 계정은 삭제할 수 없습니다.");return}if(l?.id!=null&&String(l.id)===t.id){x("본인 계정은 삭제할 수 없습니다.");return}if(window.confirm(`"${t.email}" 유저를 삭제할까요?`)){x(null),z(t.id);try{const s=await Ne(t.id);s.success?le():x(s.message??"삭제에 실패했습니다.")}catch(s){const r=s,d=r?.response?.data?.message??r?.message??"삭제에 실패했습니다.";x(d)}finally{z(null)}}};a.useEffect(()=>{R(!0),Promise.all([_(),q(),H()]).then(([t,s,r])=>{k(t),A(s),$(r),t.length>0&&!m&&E(t[0].id)}).finally(()=>R(!1))},[]),a.useEffect(()=>{m&&be(m).then(Y)},[m]);const ie=()=>{c(),n("/login",{replace:!0})},oe=()=>{b(null),f("");const t=new Date;t.setMonth(t.getMonth()+1);const s=new Date(t);s.setDate(s.getDate()+7),N(t.toISOString().slice(0,16)),w(s.toISOString().slice(0,16)),o(""),y(!0)},de=t=>{b(t),f(t.name),N(t.startDate.slice(0,16)),w(t.endDate.slice(0,16)),o(""),y(!0)},C=()=>{y(!1),b(null),o("")},ce=async()=>{if(o(""),!h.trim()){o("대회 이름을 입력하세요.");return}M(!0);try{if(p){const t=await ye(p.id,{name:h.trim(),startDate:j,endDate:v});t.success?(G(),C()):o(t.message)}else{const t=await ge({name:h.trim(),startDate:j,endDate:v});t.success?(G(),C()):o(t.message)}}finally{M(!1)}},me=[{key:"competition",label:"대회 관리"},{key:"teams",label:"팀 확인"},{key:"users",label:"유저 관리"}];return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>n("/"),className:"text-gray-600 hover:text-gray-900 text-sm font-medium",children:"← 서비스 홈"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"관리자"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:l?.nickname??l?.email}),e.jsx("button",{type:"button",onClick:ie,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"로그아웃"})]})]}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 border-t border-gray-100",children:e.jsx("nav",{className:"flex gap-1 pt-2",children:me.map(({key:t,label:s})=>e.jsx("button",{type:"button",onClick:()=>W(t),className:`px-4 py-2.5 text-sm font-medium rounded-t-lg transition-colors ${u===t?"bg-white text-teal-600 border border-b-0 border-gray-200 -mb-px":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:s},t))})})]}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:te?e.jsx("div",{className:"flex justify-center py-16 text-gray-500",children:"로딩 중..."}):e.jsxs(e.Fragment,{children:[u==="competition"&&e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"대회 목록"}),e.jsx("button",{type:"button",onClick:oe,className:"px-4 py-2 text-sm font-medium text-white bg-teal-500 hover:bg-teal-600 rounded-lg transition-colors",children:"대회 추가"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"이름"}),e.jsx("th",{className:"px-6 py-3",children:"시작일"}),e.jsx("th",{className:"px-6 py-3",children:"종료일"}),e.jsx("th",{className:"px-6 py-3",children:"상태"}),e.jsx("th",{className:"px-6 py-3 w-24",children:"관리"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:D.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-gray-600 text-sm",children:Q(t.startDate)}),e.jsx("td",{className:"px-6 py-4 text-gray-600 text-sm",children:Q(t.endDate)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 text-xs font-medium rounded-full ${t.status==="ongoing"?"bg-teal-100 text-teal-700":t.status==="upcoming"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:J[t.status]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{type:"button",onClick:()=>de(t),className:"text-sm text-teal-600 hover:text-teal-700 font-medium",children:"수정"})})]},t.id))})]})})]}),u==="teams"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"대회별 팀 (랭킹)"}),e.jsx("select",{value:m??"",onChange:t=>E(Number(t.target.value)||null),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500",children:D.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",J[t.status],")"]},t.id))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"순위"}),e.jsx("th",{className:"px-6 py-3",children:"팀명"}),e.jsx("th",{className:"px-6 py-3",children:"총 평가액"}),e.jsx("th",{className:"px-6 py-3",children:"수익률"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:X.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsxs("td",{className:"px-6 py-4 font-medium text-gray-900",children:[t.rank,"위"]}),e.jsx("td",{className:"px-6 py-4",children:t.groupName}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[t.totalValue.toLocaleString("ko-KR"),"원"]}),e.jsxs("td",{className:`px-6 py-4 font-medium ${t.profitLossPercentage>=0?"text-red-500":"text-blue-500"}`,children:[t.profitLossPercentage>=0?"+":"",t.profitLossPercentage,"%"]})]},t.teamId))})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"매칭방 (팀 구성 대기)"}),K&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:K})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"방 이름"}),e.jsx("th",{className:"px-6 py-3",children:"멤버"}),e.jsx("th",{className:"px-6 py-3",children:"상태"}),e.jsx("th",{className:"px-6 py-3 w-40",children:"관리"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:Z.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:t.name}),e.jsxs("td",{className:"px-6 py-4 text-gray-600",children:[t.memberCount,"/",t.capacity,"명 (",t.members.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 mr-1",children:[s.nickname,e.jsx("button",{type:"button",onClick:()=>ne(t.id,s.userId),disabled:P===`${t.id}-${s.userId}`,className:"text-red-500 hover:text-red-700 text-xs disabled:opacity-50",title:"멤버 강제 제거",children:P===`${t.id}-${s.userId}`?"제거 중...":"제거"})]},s.userId)),")"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 text-xs font-medium rounded-full ${t.status==="full"?"bg-teal-100 text-teal-700":t.status==="started"?"bg-gray-100 text-gray-600":"bg-amber-100 text-amber-700"}`,children:t.status==="waiting"?"대기 중":t.status==="full"?"정원 참":"시작됨"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{type:"button",onClick:()=>ae(t.id),disabled:L!==null,className:"text-sm text-red-600 hover:text-red-700 font-medium disabled:opacity-50",children:L===t.id?"삭제 중...":"방 삭제"})})]},t.id))})]})})]})]}),u==="users"&&e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"유저 목록"}),B&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:B})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-sm font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"이메일"}),e.jsx("th",{className:"px-6 py-3",children:"닉네임"}),e.jsx("th",{className:"px-6 py-3",children:"팀"}),e.jsx("th",{className:"px-6 py-3",children:"역할"}),e.jsx("th",{className:"px-6 py-3 w-24",children:"삭제"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:ee.map(t=>{const s=l?.id!=null&&String(l.id)===t.id,r=t.role==="admin"||s;return e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"px-6 py-4 text-gray-900",children:t.email}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:t.nickname}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:t.teamId??"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 text-xs font-medium rounded-full ${t.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-600"}`,children:t.role==="admin"?"관리자":"일반"})}),e.jsx("td",{className:"px-6 py-4",children:r?e.jsx("span",{className:"text-gray-400 text-sm",children:"—"}):e.jsx("button",{type:"button",disabled:O===t.id,onClick:()=>re(t),className:"text-red-600 hover:text-red-700 text-sm font-medium disabled:opacity-50",children:O===t.id?"삭제 중...":"삭제"})})]},t.id)})})]})})]})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:p?"대회 수정":"대회 추가"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대회 이름"}),e.jsx("input",{type:"text",value:h,onChange:t=>f(t.target.value),placeholder:"예: 2025 봄 시즌 대회",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"datetime-local",value:j,onChange:t=>N(t.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"datetime-local",value:v,onChange:t=>w(t.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),I&&e.jsx("p",{className:"text-sm text-red-600",children:I})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:C,className:"flex-1 py-2.5 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"취소"}),e.jsx("button",{type:"button",onClick:ce,disabled:U,className:"flex-1 py-2.5 text-sm font-semibold text-white bg-teal-500 rounded-lg hover:bg-teal-600 disabled:opacity-50",children:U?"저장 중...":p?"수정":"추가"})]})]})})]})}export{Ce as default};
//# sourceMappingURL=page-DyDGt1Rl.js.map
